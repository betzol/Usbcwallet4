<!DOCTYPE html><!--worldCities--><!--empiezan los scripts-->
<head>
  <meta charset="UTF-8" />
 <title>  ||   www.3coma14apps.com||Usbcwallet4||pi Network app||testnet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
  
   <style> #globe { width: 400px; height: 400px; margin: 50px auto; background-size: cover; background-position: center; border-radius: 50%; box-shadow: 0 0 30px #000; } </style>
  
  <style>
 
  
  
    :root {
  --bg: #f8fafc;
  --fg: #1e293b;
  --fg-muted: #475569;
  --border: #cbd5e1;
  --green: #059669;
  --green-hover: #047857;
}

* { box-sizing: border-box; }

body {
  margin: 0; padding: 0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Arial, 'Helvetica Neue';
  background: var(--bg);
  color: var(--fg);
}

.container {
  max-width: 760px;
  margin: 2rem auto;
  padding: 0 1rem;
}

.card {
  background: #fff;
  border: 1px solid var(--border);
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  padding: 16px;
  overflow: hidden;
}

h1 {
  font-size: 1.6rem;
  margin: 0 0 0.25rem;
  color: #0f172a;
  display: flex; align-items: center; gap: 8px;
}

.subtle { color: var(--fg-muted); font-size: 0.9rem; margin: 0.25rem 0 0.75rem; }

.row {
  display: flex; align-items: center; justify-content: space-between;
  gap: 12px; flex-wrap: wrap;
}

.badge {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 4px 8px; border-radius: 999px; font-size: 0.78rem; font-weight: 600;
  background: #e2e8f0; color: #0f172a;
}
.badge.green { background: #d1fae5; color: #065f46; }
.badge.gray { background: #e5e7eb; color: #374151; }
.badge.yellow { background: #fef3c7; color: #92400e; }

.toggle-wrap { display: inline-flex; align-items: center; gap: 8px; }
.toggle-label { font-size: 0.9rem; color: #374151; font-weight: 600; }

.toggle-switch {
  appearance: none;
  width: 44px; height: 24px;
  background-color: #cbd5e1;
  border-radius: 999px;
  position: relative; outline: none; cursor: pointer;
  transition: background-color 0.2s ease;
}
.toggle-switch::before {
  content: "";
  position: absolute; top: 3px; left: 3px;
  width: 18px; height: 18px; border-radius: 50%;
  background: #fff; transition: transform 0.2s ease;
  box-shadow: 0 1px 2px rgba(0,0,0,0.2);
}
.toggle-switch:checked { background-color: var(--green); }
.toggle-switch:checked::before { transform: translateX(20px); }

.alert {
  display: flex; align-items: center; gap: 8px;
  background: #fef3c7; color: #92400e;
  border: 1px solid #f59e0b; border-radius: 8px;
  padding: 8px 10px; font-size: 0.9rem;
}

.grid { display: grid; gap: 12px; grid-template-columns: 1fr; }
@media (min-width: 520px) { .grid { grid-template-columns: 1fr 1fr; } }

.panel {
  border: 1px solid var(--border); border-radius: 8px; padding: 10px;
  background: #f8fafc;
}

.panel.orange { background: #fff7ed; border-color: #fdba74; }
.panel.green  { background: #ecfdf5; border-color: #6ee7b7; }

.mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; }
.testnet-input {
  border: none; background: transparent; width: 100%; padding: 0; margin-top: 6px;
}

label { display: block; margin-top: 12px; font-weight: 600; font-size: 0.88rem; color: #0f172a; }
input[type="number"], input[type="text"] {
  width: 100%; margin-top: 6px; padding: 10px 12px; font-size: 0.95rem;
  border: 1px solid var(--border); border-radius: 8px; background: #ffffff;
}
input::placeholder { color: #9ca3af; }

.btn {
  margin-top: 16px; width: 100%; padding: 12px 14px;
  background: var(--green); color: #fff; border: none; border-radius: 8px;
  font-size: 1rem; font-weight: 700; cursor: pointer;
  display: inline-flex; align-items: center; justify-content: center; gap: 8px;
  transition: background 0.2s ease, transform 0.02s ease;
}
.btn:hover { background: var(--green-hover); }
.btn:active { transform: translateY(1px); }
.btn[disabled] { opacity: 0.6; cursor: not-allowed; }

.logs {
  margin-top: 16px; font-size: 0.84rem;
  background: #f1f5f9; border: 1px solid var(--border);
  padding: 8px; border-radius: 8px; max-height: 220px; overflow-y: auto;
}

table { width: 100%; margin-top: 12px; border-collapse: collapse; font-size: 0.85rem; }
th, td { padding: 8px; border: 1px solid var(--border); text-align: left; }
thead th { background: #e2e8f0; font-weight: 700; }
/* Iconos/colores diferenciados por modo */
.icon { font-style: normal; }
.icon-mainnet { color: #065f46; }   /* verde oscuro */
.icon-testnet { color: #92400e; }   /* naranja oscuro */

/* Estilos para l√≠neas de log por modo */
.log-line { display: block; }
.log-mainnet { color: #065f46; }
.log-testnet { color: #92400e; }

/* Badges de modo visualmente distintos */
.badge-mode { display: inline-flex; align-items: center; gap: 6px; }
.badge-mode.mainnet { background: #d1fae5; color: #065f46; }
.badge-mode.testnet { background: #fef3c7; color: #92400e; }

  </style>
  <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { 
            max-width: 900px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 12px; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        .header {
    border-radius: 8px;
      max-width: 1400px; 
    background: linear-gradient(135deg, #059669 0%, #ff1818 100%);
    color: white;
    padding: 24px;
    text-align: center;

        }
        .header h1 { font-size: 28px; margin-bottom: 8px; }
        .header p { opacity: 0.9; }
        .content { padding: 24px; }
        .section { 
            
           padding: 8px 16px; 
          
            gap: 16px; 
            margin-top: 16px; 
            
            margin-bottom: 32px;
            border: 1px solid #d1fae5; 
           /* border-bottom: 2px solid #d1fae5;*/
             border-radius: 4px; /* opcional, esquinas redondeadas */
             border-color: #fdba74;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
             transition: background-color 0.3s ease;
            
            
            
        }
        .section h2 { 
            color: #059669; 
            margin-bottom: 16px; 
            font-size: 20px;
            border-bottom: 2px solid #d1fae5;
            padding-bottom: 8px;
        }
        .wallet-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
            gap: 16px; 
            margin-top: 16px; 
        }
        .wallet-card { 
            
            
              
            
            
            border: 1px solid #d1fae5; 
            border-radius: 8px; 
            padding: 16px; 
            background: #f0fdf4;
            transition: transform 0.2s;
            width: 940px;
            
            
            
        }
        .wallet-card img {
  width: 100%;
  max-width: 160px;
  height: auto;
  margin: 0 auto 8px;
  display: block;
}
        .wallet-card:hover { transform: translateY(-2px); }
        .wallet-card h3 { color: #059669; margin-bottom: 8px; }
        .wallet-card p { color: #374151; font-size: 14px; margin-bottom: 4px; }
        .value { font-weight: bold; color: #059669; font-size: 18px; }
        .url { 
            font-family: monospace; 
            background: #e5e7eb; 
            padding: 4px 8px; 
            border-radius: 4px; 
            font-size: 12px;
            word-break: break-all;
        }
        .button { 
                background-color: #fbb44a;
            color: white; 
            border: none; 
            padding: 8px 16px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 14px;
            margin: 4px 4px 4px 0;
        }
        .button:hover { background: #1bf779; }
        .button.danger { background: #dc2626; }
        .button.danger:hover { background: #b91c1c; }
        .status { 
            padding: 12px; 
            border-radius: 6px; 
            margin-bottom: 16px; 
            text-align: center;
        }
        .status.offline { background: #fef3c7; color: #92400e; }
        .status.secure { background: #d1fae5; color: #065f46; }
        .instructions { 
            background: #f9fafb; 
            border-left: 4px solid #059669; 
            padding: 16px; 
            margin: 16px 0;
        }
        .file-input { 
            margin: 16px 0; 
            padding: 12px; 
            border: 2px dashed #d1fae5; 
            border-radius: 8px; 
            text-align: center;
        }
        input[type="file"] { margin: 8px 0; }
        .footer { 
            background: #f9fafb; 
            padding: 16px 24px; 
            text-align: center; 
            color: #6b7280; 
            font-size: 14px;
        }
        .security-section {
            background: #fef2f2;
            border: 2px solid #fecaca;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        
         .security-section2 {
           background: #ff9b07;
           border: 2px solid #fd5d03;
           border-radius: 8px;
           padding: 16px;
           margin: 16px 0;
        }
        
        
        .qr-code {
            display: inline-block;
            padding: 8px;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            margin: 8px;
        }
        .seed-phrase {
            background: #f3f4f6;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            padding: 16px;
            font-family: monospace;
            font-size: 14px;
            line-height: 1.5;
            margin: 8px 0;
        }
        .private-key {
            background: #fef2f2;
            border: 2px solid #fecaca;
            border-radius: 8px;
            padding: 16px;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
            margin: 8px 0;
        }
        .tabs {
  display: flex;
  border-bottom: 2px solid #e5e7eb;
  margin-bottom: 16px;
  max-width: 1400px; 
  overflow-x: auto;              /* habilita scroll horizontal */
  -webkit-overflow-scrolling: touch; /* scroll suave en iOS */
}



.tab {
    
    
     /* cursor: default; /* flechita normal */
      background-color: #fbb44a;
      cursor: pointer; /* mano */
    border-bottom: 2px solid transparent;
            transition: all 0.2s; 
     padding: 12px 24px;
  flex: 0 0 auto; /* evita que las tabs se encojan */
}

        .tab.active {
            border-bottom-color: #059669;
            color: #059669;
            font-weight: 600;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }        
   
:root {
    --primary:#5bff00; --border:#cbd5e1; --bg:#f8fafc; --text:#0f172a; --muted:#64748b;
    --danger:#ef4444; --card:#ffffff;
  }
    
  * { box-sizing: border-box; }
  body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"; background: var(--bg); color: var(--text); }
  .container { max-width: 960px; margin: 48px auto; padding: 0 16px; }
  .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 24px; box-shadow: 0 2px 12px rgba(2,6,23,.05); }
  .title { margin: 0 0 6px; font-size: 22px; font-weight: 800; letter-spacing: -0.01em; }
  .subtitle { margin: 0 0 18px; color: var(--muted); }

  .dropzone {
    position: relative; border: 2px dashed var(--border); border-radius: 12px; background: #fff;
    padding: 28px; text-align: center; transition: border-color .18s, background .18s;
  }
  .dropzone.dragover { border-color: var(--primary); background: #f0fdf4; }
  .dz-inner { max-width: 560px; margin: 0 auto; }
  .dz-icon { display:inline-flex; align-items:center; justify-content:center; width: 48px; height:48px; color: var(--primary); margin-bottom: 8px; }
  .dz-title { font-weight: 700; margin-bottom: 6px; }
  .dz-help { color: var(--muted); font-size: 14px; margin-bottom: 14px; }

  .toolbar { display:flex; flex-wrap:wrap; gap:10px; justify-content:center; }
  .btn {
    appearance: none; border: 1px solid var(--border); background:#fff; color: var(--text);
    padding: 10px 14px; border-radius: 10px; font-weight: 700; cursor: pointer; transition: .18s;
  }
  .btn:hover { border-color:#94a3b8; transform: translateY(-1px); }
  .btn-primary { background: var(--primary); color:#fff; border-color: var(--primary); }
  .btn-primary:hover { filter: brightness(.96); }
  .btn-danger { border-color: #fecaca; background: #fee2e2; color: #991b1b; }
  .btn-danger:hover { filter: brightness(.98); }

  input[type=file] { display:none; }

  .summary {
    margin-top: 14px; display:flex; gap:16px; flex-wrap:wrap; align-items:center; justify-content:space-between;
    color: var(--muted); font-size: 14px;
  }
  .summary .stats { display:flex; gap:16px; flex-wrap:wrap; }
  .summary b { color: var(--text); }

  .preview { margin-top: 18px; display:grid; grid-template-columns: repeat( auto-fit, minmax(220px, 1fr) ); gap: 14px; }
  .item { border: 1px solid var(--border); border-radius: 12px; overflow: hidden; background: #fff; display:flex; flex-direction: column; position:relative; }
  .thumb { width:  20%;
  height: 100px;
  object-fit: cover;
  background: #f1f5f9;
  display: block;
  margin: 0 auto; }
  .meta { padding: 10px; display:grid; gap:8px; }
  .filename { font-size: 12px; color: var(--muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .label { font-size: 12px; color: var(--muted); }
  .input { width:100%; padding: 8px 10px; border:1px solid var(--border); border-radius: 8px; outline: none; transition: border-color .18s, box-shadow .18s; }
  .input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(16,185,129,.16); }
  .remove { position:absolute; top:8px; right:8px; border:none; background:#fff; border-radius: 999px; width: 32px; height:32px; box-shadow: 0 2px 8px rgba(0,0,0,.12); cursor:pointer; display:flex; align-items:center; justify-content:center; }
  .remove:hover { background: #fef2f2; color: #b91c1c; }

  .progress { display:none; margin-top:16px; }
  .bar-wrap { background:#e5e7eb; border-radius: 10px; height: 10px; overflow: hidden; }
  .bar { height:100%; width:0%; background: linear-gradient(90deg, #10b981, #34d399); transition: width .2s; }
  .progress-label { margin-top:8px; font-size: 13px; color: var(--muted); }

  .output { display:none; margin-top: 18px; background: #0b1220; color: #d1e7ff; padding: 16px; border-radius: 12px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 13px; overflow: auto; max-height: 520px; border: 1px solid #0b2942; }
  .out-actions { display:none; margin-top:10px; gap:10px; justify-content:flex-end; }
  .footer { margin-top: 18px; display:flex; justify-content:center; color: var(--muted); font-size: 12px; }
  
  
  
  .file-input {
  margin-top: 16px;
  display: block;
}

.file-input input[type="file"] {
  display: inline-block;
  padding: 6px 10px;
  font-size: 14px;
  border: 1px solid #ccc;
  background-color: #fff;
  color: #000;
  cursor: pointer;
}

.file-input button {
  margin-left: 8px;
  padding: 6px 12px;
  font-size: 14px;
  cursor: pointer;
}

  input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button {
  display: none;
  margin: 0;
}

input[type=number] {
  -moz-appearance: textfield; /* Firefox */
}
#hotWalletBalance {
  pointer-events: none;       /* bloquea clics y teclado */
  user-select: none;          /* impide selecci√≥n de texto */
  -moz-appearance: textfield; /* quita flechas en Firefox */
  border: none;
  background: transparent;
  font-weight: bold;
  font-size: 1.2em;
  color: #1e293b;             /* mismo color que el texto normal */
}

input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button {
  display: none;              /* quita flechas en Chrome/Safari */
  margin: 0;
}
body.dark-mode {
  background: #000000;
  color: #000000;
}

body.dark-mode .card,
body.dark-mode .dropzone,
body.dark-mode .wallet-card,
body.dark-mode .panel,
body.dark-mode .file-input,
body.dark-mode .output {
  background: #000000;
  border-color: #334155;
  color: #f1f5f9;
}

body.dark-mode .btn {
  background: #334155;
  color: #f8fafc;
  border-color: #475569;
}
body.dark-mode .btn-primary {
  background: #059669;
  border-color: #059669;
  color: #fff;
}
body.dark-mode .btn-danger {
  background: #991b1b;
  border-color: #fecaca;
  color: #fee2e2;
}

body.dark-mode .dz-help,
body.dark-mode .subtitle,
body.dark-mode .label,
body.dark-mode .filename {
  color: #94a3b8;
}

body.dark-mode .input,
body.dark-mode input[type="number"] {
  background: #1e293b;
  border-color: #475569;
  color: #f8fafc;
}
body.dark-mode {
  background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
}
body.dark-mode .card,
body.dark-mode .wallet-card,
body.dark-mode .dropzone {
  background: #1e293b;
  border-color: #334155;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}
body.dark-mode .btn-primary {
  background: #10b981;
  border-color: #10b981;
  color: #ffffff;
}
body.dark-mode .btn-danger {
  background: #ef4444;
  border-color: #ef4444;
  color: #ffffff;
}
body.dark-mode .dz-help,
body.dark-mode .label,
body.dark-mode .filename {
  color: #94a3b8;
}
body.dark-mode .input,
body.dark-mode input[type="number"] {
  background: #000000;
  border-color: #475569;
  color: #f8fafc;
}
#popup {
  display: none;
  position: fixed;
  bottom: 160px;
  left: 50%;
  transform: translateX(-50%);
  background: #0f0;
  padding: 1em;
  border-radius: 5px;
  color: #000;
  font-weight: bold;
  z-index: 2000;
}

  .modal {
  display: none;
  position: fixed;
  z-index: 999;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.5);
   z-index: 3000;
}
.modal-content {
  background: #d00;
  border-color: #988aa5;
  border-style: solid;
  margin: 15% auto;
  padding: 20px;
  width: 600px;
  text-align: center;
  border-radius: 8px;
}
#walletCards, #mintedCards {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  max-height: 600px;
  overflow-y: auto;
}

.wallet-card {
  border: 1px solid #ccc;
  padding: 12px;
  width: 240px;
  background: #f9f9f9;
}
.auth-button  {
background-color: #fbb44a;
            color: red; 
            border: 2px; 
            padding: 8px 16px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 14px;
            margin: 4px 4px 4px 0;
        }
 /* Contenedor de la galer√≠a */
#userGallery {
    
    padding: 8px 16px; 
    gap: 16px; 
     
   
     border: 1px solid #d1fae5; 
           /* border-bottom: 2px solid #d1fae5;*/
    border-radius: 4px; /* opcional, esquinas redondeadas */
     border-color: #fdba74;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    transition: background-color 0.3s ease;
  display: flex;
  border-radius: 5px;
  flex-wrap: wrap;
  gap: 1rem;
  /*margin-top: 20px;*/
  /* margin-bottom: 32px;*/
}

/* Card de cada pago */

.payment-card .card-body {
  max-height: 80px;
  overflow: hidden;
  transition: max-height 0.3s ease;
}
.payment-card:hover .card-body {
  max-height: 500px;
}





.payment-card {
  background: #ffffff;
  border: 1px solid #ddd;
  border-radius: 8px;
  width: 280px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  overflow: hidden;
  font-family: system-ui, sans-serif;
}

/* Cabecera */
.payment-card .card-header {
  background: #f5f5f5;
  padding: 8px 12px;
  font-weight: bold;
  font-size: 14px;
  border-bottom: 1px solid #ddd;
}

/* Cuerpo */
.payment-card .card-body {
  padding: 12px;
  font-size: 13px;
  line-height: 1.4;
}

.payment-card .card-body p {
  margin: 4px 0;
}


/* Imagen dentro de la cabecera */
.payment-card .card-header img {
  display: block;        /* que se comporte como bloque */
  max-width: 100%;       /* nunca m√°s ancho que la card */
  height: 150px;         /* altura fija */
  object-fit: cover;     /* recorta para que encaje sin deformarse */
  margin-top: 8px;       /* separaci√≥n respecto al texto */
  border-radius: 4px;    /* esquinas redondeadas opcionales */
}




/* Acciones */
.payment-card .card-actions {
  display: flex;
  justify-content: space-between;
  padding: 8px 12px;
  border-top: 1px solid #ddd;
}

.payment-card .card-actions button {
  background: #007bff;
  border: none;
  color: #fff;
  font-size: 12px;
  padding: 6px 10px;
  border-radius: 4px;
  cursor: pointer;
  transition: background 0.2s;
}

.payment-card .card-actions button:hover {
  background: #0056b3;
}
.toggle-switch {
  appearance: none;
  width: 44px; height: 24px;
  background-color: #cbd5e1;
  border-radius: 999px;
  position: relative; outline: none; cursor: pointer;
  transition: background-color 0.2s ease;
}
.toggle-switch::before {
  content: "";
  position: absolute; top: 3px; left: 3px;
  width: 18px; height: 18px; border-radius: 50%;
  background: #fff; transition: transform 0.2s ease;
  box-shadow: 0 1px 2px rgba(0,0,0,0.2);
}
.toggle-switch:checked { background-color: var(--green); }
.toggle-switch:checked::before { transform: translateX(20px); }

.alert {
  display: flex; align-items: center; gap: 8px;
  background: #fef3c7; color: #92400e;
  border: 1px solid #f59e0b; border-radius: 8px;
  padding: 8px 10px; font-size: 0.9rem;
}

.grid { display: grid; gap: 12px; grid-template-columns: 1fr; }
@media (min-width: 520px) { .grid { grid-template-columns: 1fr 1fr; } }

.panel {
  border: 1px solid var(--border); border-radius: 8px; padding: 10px;
  background: #f8fafc;
}

.panel.orange { background: #fff7ed; border-color: #fdba74; }
.panel.green  { background: #ecfdf5; border-color: #6ee7b7; }

.mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; }
.testnet-input {
  border: none; background: transparent; width: 100%; padding: 0; margin-top: 6px;
}
 
</style>
      <style>
    /* Estilos generales */
    body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        margin: 0;
        padding: 0;
    }

    /* Botones flotantes */
    .scroll-btn {
        position: fixed;
        right: 20px;
        padding: 10px 15px;
        font-size: 16px;
        border: none;
        border-radius: 5px;
        background-color: #007BFF;
        color: white;
        cursor: pointer;
        box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        transition: background-color 0.3s ease;
        z-index: 1000;
    }

    .scroll-btn:hover {
        background-color: #0056b3;
    }

    /* Posiciones */
    #btnUp {
        bottom: 70px;
    }

    #btnDown {
        bottom: 20px;
    }
 
 

 
 
    
 /* Contenedor de la galer√≠a global (todos los usuarios) */
#alluserGallery {
    
   /*display: block;*/        /* que se comporte como bloque */
  max-width: 100%;       /* nunca m√°s ancho que la card */
 /* height: 750px; */        /* altura fija */
  object-fit: cover;    /* recorta para que encaje sin deformarse */
  margin-top: 8px;       /* separaci√≥n respecto al texto */
  border-radius: 4px;    /* esquinas redondeadas opcionales */ 
    
 display: flex;
/* display: grid;*/
  flex-wrap: wrap;
  gap: 5rem;
  margin-top: 20px;
  justify-content: flex-start;
}   
.user-img {
  width: 100px;
  height: auto;   /* mantiene la proporci√≥n */
  border-radius: 4px; /* opcional, esquinas redondeadas */
  border-color: #fdba74;
   box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        transition: background-color 0.3s ease;
}

  </style>

  <style>
#canvasWrapper {
    
    background: radial-gradient(circle at 50% 20%, #0a0a1a, #000000 80%);  
  width: 100%;
  display: flex;
  justify-content: center;
  margin-top: 20px;
  padding: 40px 0;
  position: relative;
}

/* ‚≠ê HALO DIFUSO DETR√ÅS */
#canvasWrapper::before {
  content: "";
  position: absolute;
  width: 500px;
  height: 500px;
  border-radius: 50%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: radial-gradient(
    circle,
    rgba(0,150,255,0.5) 0%,
    rgba(0,0,0,0) 120%
  );
  filter: blur(40px);
  pointer-events: none;
  z-index: 0;
}

 
  


/* ‚≠ê BORDE FRONTAL */
#canvasWrapper::after {
  content: "";
  position: absolute;
  
  width: 260px;
  height: 260px;
  
  
  
  border-radius: 50%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  border: 3px solid rgba(255,255,255,0.4);
  pointer-events: none;
  z-index: 3;
}

/* ‚≠ê CANVAS EN EL MEDIO */
#cas {
  position: relative;
  z-index: 5; /* ‚≠ê por encima de innerCircle, lightSpot y topGloss */
}



 #innerCircle {
  position: absolute;
  
  width: 260px;   /* ajustado para encajar dentro del borde de 260px */
  
  height: 260px;
  border-radius: 50%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);

  /* ‚≠ê EFECTO METAL PULIDO */
  background: radial-gradient(circle at 30% 30%,
    rgba(255,255,255,0.35) 0%,     /* brillo superior */
    rgba(200,200,200,0.15) 35%,    /* zona suave */
    rgba(80,80,80,0.25) 100%       /* sombra met√°lica */
  );

  /* ‚≠ê PROFUNDIDAD INTERIOR */
  box-shadow:
    inset 0 0 25px rgba(255,255,255,0.25),
    inset 0 0 45px rgba(0,0,0,0.45),
    0 0 12px rgba(255,255,255,0.1);

  /* ‚≠ê BORDE MET√ÅLICO */
  border: 1px solid rgba(255,255,255,0.45);

  z-index: 2;
  pointer-events: none;
}
#lightSpot {
  position: absolute;
  width: 260px;
  height: 260px;
  border-radius: 50%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);

  background: radial-gradient(circle at 50% 20%,
    rgba(255,255,255,0.35) 0%,
    rgba(255,255,255,0.10) 25%,
    rgba(255,255,255,0.00) 70%
  );

  z-index: 3; /* encima del metal, debajo del borde */
  pointer-events: none;
}

#topGloss {
  position: absolute;
  width: 260px;
  height: 130px; /* solo la mitad superior */
  border-radius: 260px 260px 0 0;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -100%);

  background: linear-gradient(
    to bottom,
    rgba(255,255,255,0.35) 0%,
    rgba(255,255,255,0.10) 40%,
    rgba(255,255,255,0.00) 100%
  );

  z-index: 4; /* encima del foco, debajo del borde */
  pointer-events: none;
}

  </style>

<style>
#countdown {
   /* position: fixed;*/
   position: center;
   /* right: 26px;*/
  /*  top: 26px;*/
    width: 100px; height: 100px;
    padding: 26px 26px;
    font-size: 14px;
    font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
    
    /* Fondo casi negro con degradado sutil */
    background: radial-gradient(circle at 10% 0%, #1f2937 0%, #020617 60%);
    
    color: #f9fafb;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    
    border-radius: 999px;
    border: 1px solid rgba(56, 189, 248, 0.6);
    
    box-shadow:
        0 0 15px rgba(56, 189, 248, 0.45),
        0 0 40px rgba(37, 99, 235, 0.25);
    
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    
    /* L√≠nea superior tipo HUD */
    box-shadow:
        0 0 15px rgba(56, 189, 248, 0.55),
        0 -1px 0 rgba(148, 163, 184, 0.5) inset,
        0 1px 0 rgba(15, 23, 42, 0.9) inset;
    
    /* Pulso suave */
    animation: countdownGlow 2.4s ease-in-out infinite;
    
    transition: 
        transform 0.25s ease,
        box-shadow 0.25s ease,
        border-color 0.25s ease;
    z-index: 1000;
}

#countdown:hover {
    transform: translateY(-1px) scale(1.02);
    border-color: rgba(96, 165, 250, 0.95);
    box-shadow:
        0 0 20px rgba(96, 165, 250, 0.75),
        0 0 50px rgba(59, 130, 246, 0.4);
}

@keyframes countdownGlow {
    0% {
        box-shadow:
            0 0 10px rgba(56, 189, 248, 0.35),
            0 0 25px rgba(37, 99, 235, 0.25);
        border-color: rgba(56, 189, 248, 0.6);
    }
    50% {
        box-shadow:
            0 0 20px rgba(96, 165, 250, 0.85),
            0 0 55px rgba(59, 130, 246, 0.6);
        border-color: rgba(125, 211, 252, 1);
    }
    100% {
        box-shadow:
            0 0 10px rgba(56, 189, 248, 0.35),
            0 0 25px rgba(37, 99, 235, 0.25);
        border-color: rgba(56, 189, 248, 0.6);
    }
}

 
</style>

<style>
    
 .control-btn {
  padding: 8px 14px;
  border-radius: 8px;
  border: none;
  background: linear-gradient(135deg, #00b3ff, #0077ff);
  color: #fff;
  font-weight: 600;
  cursor: pointer;
  margin: 4px;
  transition: 0.15s;
}

.control-btn:hover {
  transform: scale(1.05);
  background: linear-gradient(135deg, #0095dd, #005fcc);
}
   
    
    
</style>

<style>
.userRow {
  display: flex;
  align-items: center;
  gap: 10px;
}

.chatUserBtn {
  padding: 4px 8px;
  font-size: 12px;
  border: none;
  border-radius: 6px;
  background: linear-gradient(135deg, #00b3ff, #0077ff);
  color: #fff;
  cursor: pointer;
}

.userInfo {
  flex: 1;        /* ‚≠ê Esto hace que el texto ocupe el espacio y el bot√≥n NO se mueva */
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
    
 #playerList {
  max-height: 160px;
  overflow-y: auto;
  padding-right: 6px;

  background: #000;
  color: #fff;
  font-family: sans-serif;
  border: 1px solid #333;
  border-radius: 8px;

  text-align: left;
  line-height: 1.8;
  font-size: 14px;
}
   
</style>


</head>
<body>
    
   <div class="container">
  <div id="console" style="background:#111;color:#0f0;padding:10px;font-family:monospace;font-size:12px;max-height:400px;overflow-y:auto;border-top:2px solid #0f0;">
  <strong>üß† Consola de depuraci√≥n:</strong><br></div>
    
    <!--div class="card"><div id="logs">üìúLogs:</div></div-->
    
    
    
    
   
    <!--div id="piStatus"></div--> 
 <div id="popup">‚úÖ Pago completado</div>   
 
 
 
 
 
  


      
   <div class="card"> 
 <div class="wallet-simulator">
          
</div></div>
   
    
        <div class="header">
            <h1>üîí Usbcwallet4</h1>
            
              
            
            <p>Professional Cold Storage Interface -Online & Offline Pi Coin Management</p>
            
             <h2><img src="https://www.3coma14apps.com/app12/public/data/users/pilt365/gallery/picoin.png" />Testnet App   œÄ </h2>
            üåê Domain: <strong>www.3coma14apps.com</strong><br/>
 <strong id="Receiver wallet"> üîê Receiver wallet:<span class="mono">GCG3CQS...</span><br/>
 
        
         
          <p><strong>piaPPBalance:</strong>  <span id="piaPPBalance">‚Äî</span></p> 
            
          
            <button id="logoutBtn" class="button" >üö™ Cerrar sesi√≥n</button>
    <button onclick="toggleDarkMode()" class="button">üåô Toggle Dark Mode</button></div> 
  
    

 
   
      

     
    <!--auth-section-->
    
  
 
 <!--auth-section-->
 
 
 
        <div class="status secure">
              <!--  ‚úÖ SECURE OFFLINE MODE - Your Pi Coins are safe in cold storage  -->
            </div>
         
        
            
            
            <div class="tabs">
                <div class="tab active" onclick="showTab('Profile')">üòé Profile</div>
                 <div class="tab" onclick="showTab('minter')">‚õè  minter</div>
                <div class="tab" onclick="showTab('security')">üîê Security</div>
                <div class="tab" onclick="showTab('transactions')">üñº pi Token MarketPlace</div>
                <div class="tab" onclick="showTab('backup')">üíæ Backup</div>
               
                <div class="tab" onclick="showTab('usb')">‚öôÔ∏è USB</div>
                <div class="tab" onclick="showTab('login')">üë§ Login</div>
                 <div class="tab" onclick="showTab('Roadmap')">üìå Roadmap</div>
            </div>
            
            
            <div class="content">
            
            
             <div id="Profile" class="tab-content active">
        
    
   
   <h2 class="security-section" >üòé Profile Features</h2>
    <!--div class="container"-->
    <section id="perfil"  class="section">
                    <!--h2>üìÅ Wallet Management</h2-->
                    
                    
                    
                 
                    <!--p>Secci√≥n del perfil Usuario</p-->
                   
                   
    <p class="instructions">Wellcome private profile. <span id="bienvenida"></span></p>

 
   <p class="instructions">Bienvenida. panel privado . <span id="bienvenida2"></span></p>

 <p class="instructions">Bienvenida. panel privado . <span id="bienvenida3"></span></p>


               <div id="user-section" style="display:none;"> </div>  
 

 <div id="auth-section"> 
 
  <button id="auth-button"  class="button"   onclick="authenticate()">  œÄ   Sign in - Pi Network </button>
 
 
 </div> 
   <img class="user-img" src="https://www.3coma14apps.com/app12/public/data/users/{username}/gallery/profile.jpg" />
     <p>user-status:  <div id="user-status">
         
         
         
      <p id="auth-status"  class="">Connecting...</p>
   
      
      
      </div>  
   <div class="status" style="display: none;"> 
   
     
   
   
   </div>   
 <div id="piStatus"></div> 
    <div id="payment-status">
    <p id="payment-status"></p></div>
 

   <p class="security-section"><strong>username:</strong> <span id="user-username"></span></p>
   <p class="security-section"><strong>UID:</strong> <span id="user-uid"></span></p>
   <p class="security-section"><strong>balance: </strong><span id="user-balance"></span></p>
   <p class="security-section"><strong>üîó wallet_address:</strong> <span id="wallet_address"  ></span></p>
    <!--p class="security-section"><strong>piUser: </strong><span id="piUser"></span></p-->
<div id="info" class="security-section">Loading location...</div>
<!--img class="user-img" src="https://www.3coma14apps.com/app12/public/data/users/pilt365/gallery/placeholder-user.jpg" /-->
<!--img class="user-img" src="https://www.3coma14apps.com/app12/public/data/users/<%= username %>/gallery/profile.jpg" /-->
 <h2 class="security-section">üåé conneccted Pioneers</h2>
 
  
  
  <div style="font-size: 18px; text-align: center; margin-bottom: 10px;">
    üó∫Ô∏è Mapa de jugadores
  </div> 
  <div id="countdown"></div>    
 
            
        <!-- ‚úÖ ESFERA 3D CANVAS -->
    

    
     
      
<!-- ‚úÖ ESFERA 3D CANVAS -->

    <!-- ‚úÖ ESFERA 3D CANVAS -->
<div id="canvasWrapper">
  
    <div id="topGloss"></div>

    <div id="lightSpot"></div>

    <div id="innerCircle"></div>

  <canvas id="cas" width="700" height="400">
  </canvas>
</div>


 

<div style="font-size: 18px; text-align: center; margin-bottom: 10px;"> 
  
          <button class="control-btn" onclick="stopRotation()">‚õî Parar</button>
    <button class="control-btn" onclick="startRotation()">‚ñ∂Ô∏è Reanudar</button>
<button class="control-btn" onclick="disableHover()">üôà Sin Hover</button>
<button class="control-btn" onclick="enableHover()">üëÅÔ∏è Con Hover</button>
    </div> 

<h2 class="security-section"> chatBox</h2>
<div id="chatBox" style="
  width: 100%;
  max-width: 600px;
  margin: 0 auto;
  /*background: #0b0d14;*/
  border: 1px solid #222838;
  border-radius: 12px;
  padding: 16px;
  box-shadow: 0 0 20px rgba(0,0,0,0.6);
  display: flex;
  flex-direction: column;
  gap: 12px;
">

   <div style="display:flex; justify-content:space-between; align-items:center; font-size:12px; color:#9da3b5;">
<!--aquihabialabotoneradelabola-->
<div> 
    <strong>Chat IA</strong>   
      <label for="langSelect" style="margin-right:4px;">Idioma:</label>
      <select id="langSelect" style="
        background:#05060a;
        color:#eee;
        border-radius:6px;
        border:1px solid #222838;
        padding:4px 6px;
        font-size:12px;
      ">
        <option value="es">Espa√±ol</option>
        <option value="en">Ingl√©s</option>
        <option value="fr">Franc√©s</option>
        <option value="de">Alem√°n</option>
      </select>
    </div>
  </div>

  <div id="messages" style="
    height: 100px;
    overflow-y: auto;
     /*background: radial-gradient(circle at top, #111624 0%, #05060a 70%);*/
     box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    transition: background-color 0.3s ease;
    padding: 8px;
    border-radius: 8px;
   
    font-size: 14px;
  ">üíåmessages Chat,click each üí¨ profile to load the chat conversation</div>
<!--button class="chatUserBtn" data-user="{{userId}}">Hablar</button-->
<!--button class="chatUserBtn" data-user="${player.userId}">Hablar</button-->
<!--button class="chatUserBtn" data-user="${p.name}">Hablar</button-->

  <form id="chatForm" style="display:flex; gap:8px;">
    <input id="messageInput" type="text" placeholder="Escribe..." autocomplete="off" style="
      flex:1;
      padding:8px 10px;
      border-radius:8px;
      border:1px solid #222838;
      background:#05060a;
      color:#eee;
      outline:none;
    ">
    <button type="submit" style="
      padding:8px 14px;
      border-radius:8px;
      border:none;
      background:linear-gradient(135deg, #00b3ff, #0077ff);
      color:#fff;
      font-weight:600;
      cursor:pointer;
    ">Enviar</button>
  </form>

  <div id="status" style="font-size:12px; opacity:0.7;">Listo.</div>


  

<div id="playerList">
  <div id="playerListContent"></div>
</div>

</div>




             <p  class="security-section2" >Secci√≥n del perfil Usuario Usbcwallet4</p>
 <p class="seed-phrase" >balance real  testnet üß™ <strong> USB-ONLINE-BALANCE:</strong> <span id="piBalance">‚Äî</span></p> 
              <!--p class="seed-phrase"><strong>Usuario:</strong> <span id="user-username"></span></p-->            
              <!--p class="seed-phrase"><strong>üòé  username:</strong> <span id="username"></span></p-->
              <p class="seed-phrase"><strong>üìÜ createdAt:</strong> <span id="createdAt"></span></p>
             <p class="seed-phrase"><strong>üìß Email:</strong> <span id="email"></span></p>
             <!--p><strong>üìß Email:</strong> <span id="emailUsuario"></span></p-->
             <!--p><strong>üí∞ Wallet ID:</strong> <span id="walletIdDisplay"></span></p-->
             <!--p><strong>status:</strong><span id=".user-status"></span--> 
             <!--/div-->
              <!--p><strong>balance:</strong>  <span id="balance">0.00</span></p--> 
              <!--p><strong>wallet:</strong> <span id="wallet"></span></p-->
              <p class="seed-phrase"><strong>‚ú® id:</strong> <span id="id"></span></p>
               <!--p><strong>üí∞ Wallet ID:</strong> <span id="walletId"></span></p-->
               <!--p class="seed-phrase"><strong>balance:</strong> <span id="balance">xlm</span></p-->  
      <!--p><strong>status:</strong><span id="status">‚úÖ Sesi√≥n iniciada</span--> <!-- status -->
              <!--/p-->
               <!--p>wallet_address: <span id="wallet_address"></span></p-->
           
             <!--/div-->
              <!--p><strong>balance:</strong>  <span id="balance">0.00</span></p--> 
              <!--p><strong>wallet:</strong> <span id="wallet"></span></p-->
              
              <!--p><strong>‚ú® id:</strong> <span id="id"></span></p-->
               <!--p><strong>üí∞ Wallet ID:</strong> <span id="walletId"></span></p-->
               <!--p><strong>balance:</strong> <span id="balance"></span></p-->  
                
              <p class="seed-phrase"><strong>üõ°  userId:</strong> <span id="userId"></span></p>
               <!--p><strong>üë§ User:</strong> <span id="User"></span></p-->
              <!--p><strong>üòé  username:</strong> <span id="username">‚Äî</span></p-->
              <!--p><strong>üìÜ createdAt:</strong> <span id="createdAt"></span></p-->
             
    <!--p>email: <span id="user-email"></span></p-->
     <!--p><strong> Private Key (KEEP SECRET):</strong> <span id="WalletAddress:"></span></p-->
   <!--span id="wallet_address"></span-->
 
              <!--p><strong>status:</strong><span id="status"></span--> <!-- status -->
                                     <!--profile-->  

             
              <!--p><strong> Private Key (KEEP SECRET):</strong> <span id="WalletAddress:"></span></p-->
             <!--p><strong>üåê ONLINE-BALANCE</strong><span id="hotWalletBalance"></span></p-->
           
           
           <div id="keyDisplay" style="display: none;"></div>
             <h4> üîó  WalletAddress:</h4>
             <div class="url" id="WalletAddress"></div>
           
 
  
  <!--p id="walletAddress" class="mb-2 text-sm font-mono text-gray-800">‚ùó</p-->

  <div class="flex flex-col items-center justify-center gap-2">
    <button onclick="copyWalletAddress()"  class="button">
      üìã Copiar direcci√≥n
    </button>

    <button onclick="generateQR()" class="button">
      üì∑ Generar QR
    </button>

    <div id="qrContainer" class="qr-code w-24 h-24 border-2 border-gray-300 rounded-lg">
    <p class="text-xs text-gray-500">Wallet QR</p></div>
            <h4  class="security-section2"> üñº  userGallery:</h4>  
     <div id="userGallery"  class="security-section" ></div> 

     <div class="footer">
  Generated by USB-2C-WALLET v2.1 | Professional Cold Storage Solution
</div>

                       
      </div>
    </section>
  </div>
</div>
       
           <div id="security" class="tab-content">
  <div class="section">
    <h2>üîê Security Features</h2>
    <div class="security-section">
      <h3>üîë Private Key Management</h3>
      
      </div>
    </div>

    <div class="instructions">
      <strong>Security Best Practices:</strong>
      <ul style="margin-left: 20px; margin-top: 8px;">
        <li>Never share your private key</li>
        <li>Keep multiple backups in secure locations</li>
        <li>Use this wallet offline only</li>
        <li>Verify all transactions before signing</li>
      </ul>
    </div>
    
    
    <div class="footer">
  Generated by USB-2C-WALLET v2.1 | Professional Cold Storage Solution
</div>
    
    
    
  </div>
</div>

 <div id="minter" class="tab-content">
  <div class="section">
    <h2>‚õè  minter</h2>
    <!--div class="container"-->
      <div class="card" aria-live="polite">
        <h2 class="title">Mint Pi Coins</h2>
        <p class="subtitle">Sube im√°genes y asigna un valor. Luego inicia el minting.</p>
        <p>Despues de mintear, baja tu json. Luego tendras una card .json.</p>
         <p>Puedes coleccionarlas...comprarlas...cambiarlas...</p>
        <div id="dropzone" class="dropzone" role="button" tabindex="0" aria-label="Drop images here or click to browse">
          <div class="dz-inner">
            <div class="dz-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="36" height="36" fill="none">
                <path d="M12 16V4m0 0 4 4m-4-4-4 4M6 20h12a2 2 0 0 0 2-2v-4M6 20a2 2 0 0 1-2-2v-4m0 0h16" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <div class="dz-title">Drop images here or click to browse</div>
            <div class="dz-help">Formatos aceptados: JPG, PNG, GIF. Tama√±o m√°ximo 10 MB por imagen.</div>
            <div class="toolbar">
              <label class="btn" for="fileInput">Choose Files</label>
              <button id="clearBtn" class="btn btn-danger" type="button">Clear</button>
              <button id="startBtn" class="btn btn-primary" type="button">Start Minting</button>
            </div>
            <div class="wallet-simulator">
              <h3>üîê USB-offLINE-BALANCE: <span id="balanceDisplay"></span></h3>
              <p><strong>offline:</strong> <span id="offline"></span></p>
              <p><strong>online:</strong> <span id="online"></span></p>
                  
             
  
              
              <!--p><strong>üåê USB-ONLINE-BALANCE:</strong> <span id="balance"></span></p-->           
              <label for="hotWalletBalance">üí∏ testnet balance :</label>
              <input id="hotWalletBalance" type="number" value="1000" min="0" />
            </div>
            <input id="fileInput" type="file" accept="image/*" multiple />
          </div>
        </div>

        <div class="summary" id="summary" hidden>
          <div class="stats">
            <span><b id="count">0</b> im√°genes</span>
            <span>Total: <b id="totalSize">0 KB</b></span>
            <span>Valor total: <b id="totalPi">0 œÄ</b></span>
          </div>
          <small id="hint" style="color:var(--muted);">Puedes ajustar el valor de cada imagen.</small>
        </div>

        <div id="preview" class="preview"></div>

        <div class="progress" id="progress">
          <div class="bar-wrap"><div id="bar" class="bar"></div></div>
          <div id="progressLabel" class="progress-label">Preparado‚Ä¶</div>
        </div>

        <pre id="output" class="output"></pre>
        <div id="outActions" class="out-actions" style="display:block">
          <button id="copyBtn" class="btn" type="button">‚úÇ  Copy JSON</button>
          <button id="downloadBtn" class="btn btn-primary" type="button">üì•  Download JSON</button>
          <button id="resetBtn" class="btn btn-danger" type="button">üí•  Reset</button>
        </div>


<!--estoesnuevo-->

<div class="card"> 
 <div class="wallet-simulator">
              <h3>üîê USB-offLINE-BALANCE: <span id="balanceDisplay">0.00</span></h3>
              <p><strong>offline:</strong> <span id="offline">0.00</span></p>
              <p><strong>online:</strong> <span id="online">0.00</span></p>
               <!--p><strong>piaPPBalance:</strong>  <span id="piaPPBalance">‚Äî</span></p--> 
</div></div>

<div class="card">
  <!-- Bot√≥n en tu frontend -->
<!--button id="payment-button" onclick="makePayment()"-->
 
<!--/button-->
 <div id="transactionLog" style="margin-top:14px;">
      <h3>Transactions</h3>
    </div> </div>
<!-- Campo para mostrar estado -->
<div id="payment-status"></div>

<div class="card">
    <h2><img src="https://www.3coma14apps.com/app12/public/data/users/pilt365/gallery/picoin.png" />Create a  œÄ Tokenized Image </h2>
     

    <!--input type="text" id="payment-image-url" placeholder="URL de la imagen" /-->

    <input id="payment-amount" type="number" placeholder="Amount" />
    <input id="payment-memo" type="text" placeholder="Memo" />
    <input id="payment-metadata" type="text" placeholder="Metadata (JSON o texto)" />
    <!--button id="payment-button" onclick="makePayment()">Create Payment</button-->
     <button id="payment-button" class="button"   onclick="makePayment()">Create Payment</button>
     
    <!--p id="payment-status"></p-->
  </div> </div>


<!--estoesnuevo-->

 <h3><!--Transacciones Realizadas--></h3>
    </div>

        
 <div class="footer">
  Generated by USB-2C-WALLET v2.1 | Professional Cold Storage Solution
</div>
     
<!--/section‚ùó-->

        </section>
      </div>
    </div>
  </div>
</div>

 

<div id="transactions" class="tab-content">
  <div class="section">
    <h2>üñº pi Token MarketPlace</h2>
    
   <div id="alluserGallery"> </div>
    
    

    

    <div id="transactionDisplay">
      <!-- Transaction details will be displayed here -->
    </div>
    
    
    <div class="footer">
  Generated by USB-2C-WALLET v2.1 | Professional Cold Storage Solution
</div>
    
    
    
  </div>
</div>
         
    <div id="backup" class="tab-content">
    <div class="section">
    <h2>üíæ Backup & Recovery</h2>
    <div class="security-section">
      <h3>üå± Seed Phrase</h3>
     
      </div>
      
    </div>

    <div class="instructions">
      <strong>Recovery Instructions:</strong>
      <ol style="margin-left: 20px; margin-top: 8px;">
        <li>Write down your seed phrase on paper</li>
        <li>Store in multiple secure locations</li>
        <li>Never store digitally or take photos</li>
        <li>Test recovery process before using</li>
      </ol>
    </div>
    
    <div class="footer">
  Generated by USB-2C-WALLET v2.1 | Professional Cold Storage Solution
</div>
    
  </div>
</div>

<div id="usb" class="tab-content">       
  <div class="section">
    <h2>‚öôÔ∏è USB Setup</h2>
USB-2C-WALLET/
Create unsigned transaction on online device
Transfer transaction file to USB
Sign transaction offline using this interface
Transfer signed transaction back to online device    
    
    
    <div class="instructions">
      <strong>Required Folder Structure:</strong>
      <pre style="background: #f3f4f6; padding: 12px; border-radius: 6px; margin-top: 8px;">
USB-2C-WALLET/
‚îú‚îÄ‚îÄ wallets/          (JSON wallet files)
‚îú‚îÄ‚îÄ gallery/user/     (Downloaded images)
‚îú‚îÄ‚îÄ keys/             (Private keys - encrypted)
‚îú‚îÄ‚îÄ transactions/     (Signed transactions)
‚îú‚îÄ‚îÄ backups/          (Recovery backups)
‚îú‚îÄ‚îÄ config/           (Configuration)
‚îú‚îÄ‚îÄ wallet.html       (This file)
‚îî‚îÄ‚îÄ installer.txt     (Setup guide)
      </pre>
    </div>
    
    <div class="footer">
  Generated by USB-2C-WALLET v2.1 | Professional Cold Storage Solution
</div>
    
  </div>
</div>


<!-- Login -->
    <div id="login" class="tab-content">
      <h2>üîê Login</h2>
      <p>Accede a tu wallet segura y personalizada.</p>
      <div class="card">
        <label>Usuario o Email:</label>
        <input type="text" class="input" />
        <label>Contrase√±a:</label>
        <input type="password" class="input" />
        <button class="btn btn-primary">Entrar</button>
      </div>
      <p>O accede con:</p>
      <div class="controls">
        <button class="btn">üîó Login con Google</button>
        <button class="btn">üêô Login con GitHub</button>
        <button class="btn">ü™ê Login con Pi Network</button>
      </div>
      <p>¬øNo tienes cuenta? <a href="registro.html">Reg√≠strate aqu√≠</a></p>
      
      
      
      <div class="footer">
  Generated by USB-2C-WALLET v2.1 | Professional Cold Storage Solution
</div>
      
      
      
      
    </div>
    
    
    
    
    
    
    
    
    
  <!-- Login -->
    <div id="Roadmap" class="tab-content">
      <h2>üìå Roadmap de features</h2>
<h1>Roadmap de features2</h1>
    <p>
        <!-- Texto de ejemplo para hacer scroll -->
      <button id="btnDown" class="scroll-btn">‚¨á Ir al Final</button>  
        L√≠nea de ejemplo
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed non risus. Suspendisse lectus tortor, dignissim sit amet, adipiscing nec, ultricies sed, dolor...
        <p>Accede a tu wallet segura y personalizada.</p>
      <div class="instructions">
      <strong>Roadmap de features:</strong>
      <pre style="background: #f3f4f6; padding: 12px; border-radius: 6px; margin-top: 8px;">
        <ol style="margin-left: 20px; margin-top: 8px;">
        <li>Registro con minting m√≠nimo (1 œÄ)</li>
        <li>Galer√≠a conjunta como marketplace</li>
        <li>Roles de vendedor (principiante, normal, supervendedor)</li>
        <li>Comisiones din√°micas por minting y venta</li>
        <li>Staking con fees recurrentes</li>
        <li>Galer√≠a conjunta como marketplace</li>
        <li>Roles de vendedor (principiante, normal, supervendedor)</li>
        <li>Ranking y m√©tricas de popularidad (likes, views, ventas)</li>
      </ol>  
 
      </pre>

        <br><br>
        (Repite este texto o a√±ade m√°s contenido para probar el scroll)
        
        
        
        
        
        
        
        
        
        
    </p>
    <p>
        <!-- M√°s contenido -->
       <pre style="background: #f3f4f6; padding: 12px; border-radius: 6px; margin-top: 8px;">  
      <strong>üìå Idea base:</strong>


Registro en la app: cada usuario debe mintear al menos 1 token/card para entrar en el marketplace.

Fee inicial: 1 œÄ por usuario ‚Üí 

Marketplace = galer√≠a conjunta: todas las cards de todos los usuarios visibles, con filtros y ranking.

  </pre>
 
    

    
<pre style="background: #f3f4f6; padding: 12px; border-radius: 6px; margin-top: 8px;">  
   <strong>üìå Roles de vendedores:</strong>

Principiante

Requisito: 1 card minteada.

Puede listar sus cards en la galer√≠a.

Comisi√≥n b√°sica por venta.

Vendedor normal

Requisito: 10 cards minteadas o X likes/views acumulados.

Menor comisi√≥n por venta.

Acceso a estad√≠sticas b√°sicas.

Supervendedor

Requisito: 100+ cards minteadas o popularidad alta.

Comisiones reducidas.

Acceso a m√©tricas avanzadas, ranking destacado.

Posibilidad de staking premium (cards bloqueadas con multiplicadores altos).
     </pre>
  
  
 <pre style="background: #f3f4f6; padding: 12px; border-radius: 6px; margin-top: 8px;">  
 <strong>üìå Flujo econ√≥mico:</strong>     
      
      
Ingreso inicial: 1 œÄ por registro (minting m√≠nimo).

Comisiones por minting: proporcionales al tama√±o de la imagen.

Comisiones por venta: % sobre cada transacci√≥n en el marketplace.

Staking: fees recurrentes por cards bloqueadas (mantenimiento).

Gamificaci√≥n: niveles de vendedor ‚Üí incentivan a mintear m√°s y vender m√°s.  

   </pre>
  
  
<pre style="background: #f3f4f6; padding: 12px; border-radius: 6px; margin-top: 8px;">  
 <strong>üìå Roadmap de features:</strong>

 [ ] Registro con minting m√≠nimo (1 œÄ)

[ ] Galer√≠a conjunta como marketplace

[ ] Roles de vendedor (principiante, normal, supervendedor)

[ ] Comisiones din√°micas por minting y venta

[ ] Staking con fees recurrentes

[ ] Ranking y m√©tricas de popularidad (likes, views, ventas)
  
  
   </pre> 
        
        
        
        
        
        
        
        
        
        <?php for($i=0; $i<100; $i++) echo "L√≠nea de ejemplo $i<br>"; ?>
    </p>

    <!-- Botones -->
    <button id="btnUp" class="scroll-btn">‚¨Ü Arriba</button>
   
    </div>  

<div class="footer">
  Generated by USB-2C-WALLET v2.1 | Professional Cold Storage Solution
</div>
  






<!--empiezan los scripts-->
<script>
let Pi, accessToken, currentUser;

window.addEventListener("load", () => {
  Pi = window.Pi;
  
 // Pi.init({ version: "2.0" });
  
  Pi.init({
      version: "2.0",
      sandbox: false,
      appId: "Usbcwallet4" });
  
  console.log(" üöÄ Pi SDK inicializado");
 
});

async function authenticate() {
  const authButton = document.getElementById("auth-button");
  authButton.disabled = true;
  //authButton.disabled = false;
  
  authButton.textContent = " ‚è≥  Connecting...";

  try {
    const scopes = ["username", "wallet_address", "payments"];
    const authResult = await Pi.authenticate(scopes, () => {});
    accessToken = authResult.accessToken;
    currentUser = authResult.user;

    const response = await fetch("/api/auth", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ accessToken, user: currentUser })
    });
    const data = await response.json();

    if (data.success) {
      updateStatus(" ‚úÖ    Connected!", "auth-status");
      document.getElementById("auth-section").style.display = "none";
     document.getElementById("bienvenida3").textContent = ` ‚ÄîœÄ  Sesi√≥n activa como  :PiNetwork   ${currentUser.username}`;
      
      document.getElementById("user-section").style.display = "block";
      document.getElementById("user-username").textContent = currentUser.username;
      document.getElementById("user-uid").textContent = currentUser.uid;
     // document.getElementById("user-balance").textContent = currentUser.balance;
     // document.getElementById("user-wallet_address").textContent = currentUser.wallet_address;
      //consultarBalance(publicKey) ;
       //console.log(`‚úÖ Sesi√≥n iniciada como ${perfil.username}`);
       // showPopup(`üë§ Bienvenido ${perfil.username}`);
    //console.log(`‚úÖ Sesi√≥n iniciada como ${perfil.Usuario}`);
       // showPopup(`üë§ Bienvenido ${perfil.Usuario}`);
       //console.log(`‚úÖ Sesi√≥n iniciada como ${piUser}`);
      //  showPopup(`üë§ Bienvenido ${piUser}`);
     
       console.log(`‚úÖ      PiNetwork     Sesi√≥n iniciada como ${currentUser.username}`);   
       
  
       // showPopup(`üë§ Bienvenido   ${currentUser.username}`);
      
      
      // document.getElementById("user-email").textContent = currentUser.email;
      
      
      
    // document.getElementById("Wallet_Address").textContent = currentUser.wallet_address || "Not available";
   // ‚ö° Aqu√≠ pintamos la wallet
  document.getElementById("wallet_address").textContent =  currentUser.wallet_address || "Not available";
 //  document.getElementById("wallet_address").textContent =
 // currentUser.wallet_address || "Not available";
// ‚ùå quita esta l√≠nea
// document.getElementById("user-balance").textContent = currentUser.balance;

// ‚úÖ deja que fetchBalance() lo pida al backend
fetchBalance();

    } else {
      updateStatus("Auth failed", "auth-status");
    }
  } catch (e) {
    updateStatus("Auth error: " + e.message, "auth-status");
    authButton.disabled = false;
    authButton.textContent = "Sign in with Pi";
  }
}

async function fetchBalance() {
  try {
    console.log("‚û°Ô∏è Llamando /api/balance con accessToken:", accessToken);

    const response = await fetch("/api/balance", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ accessToken })
    });

    const data = await response.json();
    console.log("‚¨ÖÔ∏è Respuesta backend /api/balance:", data);

    const el = document.getElementById("user-balance");
    if (!el) {
      console.error("‚ùå #user-balance no existe en el DOM");
      return;
    }

    el.textContent = data.success ? data.balance + " Pi" : "Error";
  } catch (err) {
    console.error("‚ùå fetchBalance error:", err);
  }
}

async function makePayment() {
  const amount = parseFloat(document.getElementById("payment-amount").value);
  const memo = document.getElementById("payment-memo").value;
  const metadataInput = document.getElementById("payment-metadata").value;

  const paymentButton = document.getElementById("payment-button");
  paymentButton.disabled = true;
  paymentButton.textContent = "Processing...";

  try {
    let metadata;
    try {
      metadata = JSON.parse(metadataInput);
    } catch {
      metadata = { note: metadataInput };
    }
    metadata.orderId = "order_" + Date.now();
    metadata.userId = currentUser.uid;

    const paymentData = { amount, memo, metadata };

    // ‚úÖ Log clave: ver qu√© se env√≠a al SDK
    console.log("üßæ paymentData enviado al Pi SDK:", paymentData);

    const payment = await Pi.createPayment(paymentData, {
      onReadyForServerApproval: (paymentId) => {
        console.log("üì° Callback onReadyForServerApproval con paymentId:", paymentId);
        approvePayment(paymentId);
      },
      onReadyForServerCompletion: (paymentId, txid) => {
        console.log("üì° Callback onReadyForServerCompletion con:", { paymentId, txid });
        completePayment(paymentId, txid);
      },
      onCancel: () => {
        console.warn("‚ö†Ô∏è Payment cancelado por el usuario");
        updateStatus("Payment cancelled");
        paymentButton.disabled = false;
        paymentButton.textContent = "Create Payment";
      },
      onError: (error) => {
        console.error("‚ùå Payment error en SDK:", error);
        updateStatus("Payment error: " + error.message);
        paymentButton.disabled = false;
        paymentButton.textContent = "Create Payment";
      }
    });

    console.log("‚úÖ Payment creado en Pi SDK:", payment);
  } catch (e) {
    console.error("‚ùå Payment failed:", e);
    updateStatus("Payment failed: " + e.message);
    paymentButton.disabled = false;
    paymentButton.textContent = "Create Payment";
  }
}

async function approvePayment(paymentId) {
  updateStatus("Approving payment...");
  try {
    console.log("‚è≥ Enviando aprobaci√≥n al backend con paymentId:", paymentId);

    const response = await fetch("/api/payments/approve", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ paymentId, accessToken })
    });
    const data = await response.json();
    console.log("üì• Respuesta de /api/payments/approve:", data);

    if (!data.success) throw new Error(data.error || "Approval failed");

    // ‚úÖ Log clave
    console.log("üëç Payment aprobado en backend:", paymentId);
  } catch (error) {
    console.error("‚ùå Approval error:", error);
    updateStatus("Approval failed: " + error.message);
  }
}

async function completePayment(paymentId, txid) {
  const paymentButton = document.getElementById("payment-button");
  document.getElementById("payment-status").textContent = "Completing payment...";

  try {
    console.log("‚è≥ Iniciando completePayment con:", { paymentId, txid });

    const response = await fetch("/api/payments/complete", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ paymentId, txid, accessToken })
    });

    const data = await response.json();
    console.log("üì• Respuesta de /api/payments/complete:", data);

    if (data.success) {
      document.getElementById("payment-status").textContent =
        "Payment completed successfully! TxID: " + txid;
      console.log("üèÅ Payment confirmado en Pi API:", { paymentId, txid });

      // üîó Recuperar el JSON completo del pago
      const res = await fetch(`/api/payments/${paymentId}`);
      const paymentData = await res.json();
      console.log("üì¶ JSON completo del pago recuperado:", paymentData);

      if (paymentData.success && paymentData.payment) {
        const finalPayment = paymentData.payment;

        // üîß Forzar que el identificador sea el username real //‚ùóhemos tocado esto ‚ùó
        finalPayment.user_uid = currentUser.username;
        if (finalPayment.metadata) {
          finalPayment.metadata.userId = currentUser.username;
        }

        // ‚úÖ Guardar en galer√≠a con endpoint correcto (/api/gallery)
        console.log("üíæ Guardando en galer√≠a:", finalPayment.identifier || finalPayment.transaction?.txid);
        try {
          const resGallery = await fetch("/api/gallery", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ userId: currentUser.username, payment: finalPayment })
          });
          const galleryResultRaw = await resGallery.text();
          let galleryResult;
          try {
            galleryResult = JSON.parse(galleryResultRaw);
            console.log("üì¶ Respuesta de /api/gallery:", galleryResult);
          } catch {
            console.error("‚ùå Backend devolvi√≥ HTML en vez de JSON:", galleryResultRaw.slice(0,200));
          }
        } catch (errGallery) {
          console.error("‚ùå Error guardando en galer√≠a:", errGallery);
        }

        // üñº Renderizar card visual
        console.log("üñº Renderizando card para pago:", finalPayment.identifier);
        renderPaymentCard({ payment: finalPayment });

        // üíæ Persistencia directa del objeto renderizado en gallery.json
        try {
          const resGalleryDirect = await fetch("/api/gallery", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ userId: currentUser.username, payment: finalPayment })
          });
          const galleryDirectResult = await resGalleryDirect.json();
          console.log("‚úÖ Persistencia directa en gallery.json:", galleryDirectResult);
        } catch (errDirect) {
          console.error("‚ùå Error en persistencia directa:", errDirect);
        }

        // üì§ Subir imagen asociada al backend
        if (typeof selectedFile !== "undefined" && selectedFile) {
          console.log("üì§ Preparando subida de imagen asociada:", selectedFile.name);
          const formData = new FormData();
          formData.append("userId", currentUser.username); // üîß usar username
          formData.append("image", selectedFile, selectedFile.name);

          // üëá Envolvemos el objeto dentro de { payment: finalPayment }
          const payload = { payment: finalPayment };

          

           // üëá Subir directamente el objeto finalPayment sin wrapper
           formData.append(
           "json",
            new Blob([JSON.stringify(finalPayment, null, 2)], { type: "application/json" }),
           `${finalPayment.identifier}.json`
            );


          try {
            const resImg = await fetch("/api/guardarImagen", { method: "POST", body: formData });
            const imgResult = await resImg.json();
            console.log("üì∏ Imagen guardada en backend:", imgResult);
          } catch (errImg) {
            console.error("‚ùå Error al guardar imagen:", errImg);
          }
        } else {
          console.warn("‚ö†Ô∏è No se seleccion√≥ ninguna imagen para este pago");
        }
      }

      // ‚ö° Refrescar balance tras unos segundos
      console.log("üîÑ Balance se refrescar√° en 2s...");
      setTimeout(() => { fetchBalance(); }, 2000);
    } else {
      throw new Error(data.error || "Completion failed");
    }
  } catch (error) {
    console.error("‚ùå Completion error:", error);
    document.getElementById("payment-status").textContent =
      "Completion failed: " + error.message;
  } finally {
    paymentButton.disabled = false;
    paymentButton.textContent = "Create Payment";
    console.log("‚úÖ Bot√≥n de pago reactivado");
  }
}

</script>
<script>
    
 document.addEventListener("click", (e) => {
  if (e.target.classList.contains("chatUserBtn")) {
    targetUserId = e.target.dataset.user;

    console.log("CLICK ‚Üí targetUserId:", targetUserId);
    console.log("CLICK ‚Üí currentUserId:", currentUserId);

    statusEl.textContent = "üíå  Chateando con: " + targetUserId;
    loadChat(targetUserId);
  }
});

</script>
<script>
  form.addEventListener("submit", async (e) => {
  console.log("SUBMIT ‚Üí currentUserId:", currentUserId, "targetUserId:", targetUserId);
 </script>
 
 <script>
  async function loadChat(target) {
  console.log("LOADCHAT ‚Üí currentUserId:", currentUserId, "target:", target);
  
    
</script>


<script>
function startCountdown(seconds) {
    const target = Date.now() + seconds * 1000;

    const timer = setInterval(() => {
        const now = Date.now();
        const diff = target - now;

        if (diff <= 0) {
            clearInterval(timer);
            document.getElementById("countdown").textContent = "00:00";
            return;
        }

        const s = Math.floor(diff / 1000);
        const m = String(Math.floor(s / 60)).padStart(2, "0");
        const r = String(s % 60).padStart(2, "0");

        document.getElementById("countdown").textContent = `${m}:${r}`;
    }, 250);
}

// Ejemplo: 5 minutos
startCountdown(5 * 60);
</script>




<script>
    
function countryToFlag(country) {
  const flags = {
    "Spain": "üá™üá∏",
    "United Kingdom": "üá¨üáß",
    "Germany": "üá©üá™",
    "France": "üá´üá∑",
    "Italy": "üáÆüáπ",
    "United States": "üá∫üá∏"
  };

  return flags[country] || "üè≥Ô∏è";
}
    
    
</script>


<script>
function computeStatus(lastSeen) {
  if (!lastSeen) return "offline"; // ‚ùì

  const now = Date.now();
  const seen = new Date(lastSeen).getTime();
  const diffMin = (now - seen) / 1000 / 60;

  if (diffMin < 1) return "ultra";        // ‚ö°
  if (diffMin < 5) return "muy_activo";   // üî•
  if (diffMin < 10) return "activo";      // üî•
  if (diffMin < 15) return "reciente";    // üü†
  if (diffMin < 30) return "presente";    // üü¢
  if (diffMin < 60) return "medio";       // üü°
  if (diffMin < 720) return "alejado";    // üü§
  return "dormido";                       // üí§
}

</script>



<script>
    
async function loadRegisteredUsers() {
  console.log("üì• Cargando usuarios desde users.json‚Ä¶");

  const res = await fetch("/api/users");
  const data = await res.json();

  if (!data.success) {
    console.warn("‚ö† No se pudo cargar users.json");
    return;
  }

  for (let u of data.users) {
 
   players.push({
  name: u.username,
 // lat: 39.5696,// mock Palma
 // lon: 2.6502,// mock Palma

lon: u.lon ?? null,
lat: u.lat ?? null,

  cards: 0,
   status: computeStatus(u.lastSeen),
   role: u.role || null,                // ‚≠ê rol manual
 
  //flag: countryToFlag(u.country || "Spain")   // ‚≠ê A√ëADIDO
  flag: u.flag || countryToFlag(u.country || "nul")


});

   
   
   
   
  }

  console.log("üì¶ players[] generado autom√°ticamente:", players);
}

    
    
</script>







<script>
 function showPopup(msg) {
    const popup = document.getElementById("popup");
    popup.innerText = msg;
    popup.style.display = "block";
    setTimeout(() => popup.style.display = "none", 5000);
  }   
    
    
</script>


<script>
  const players = [];   
 const cityBalls = []; 
 const coastBalls = [];

  let hoverEnabled = true;
let rotationEnabled = true;
  
// ‚úÖ CONFIGURACI√ìN B√ÅSICA DEL CANVAS
console.log("üß† [INIT] Iniciando motor de esfera 3D‚Ä¶");

const canvas = document.getElementById("cas");
const ctx = canvas.getContext("2d");
const vpx = canvas.width / 2;
const vpy = canvas.height / 2;
const Radius = 130;

const balls = [];      // puntos blancos base
const userBalls = [];  // jugadores STOLEN + usuario Pi
let hoveredPlayer = null;

// ‚úÖ VELOCIDAD DE GIRO SUAVE
let angleX = 0.000;
let angleY = 0.01;

// ‚úÖ LISTA REAL DE JUGADORES (solo Pi User)

console.log("üì¶ [PLAYERS] Lista inicial vac√≠a:", players);

// ‚úÖ RENDER LISTA STOLEN
function renderPlayerList() {
  console.log("üìù [bola] Renderizando lista de jugadores‚Ä¶");

  const box = document.getElementById("playerListContent");
  box.innerHTML = "";

  for (let p of players) {

    // ICONO DE ACTIVIDAD
    const icon =
      p.status === "ultra" ? "‚ö°" :
      p.status === "muy_activo" ? "üî•" :
      p.status === "activo" ? "üî•" :
      p.status === "reciente" ? "üü†" :
      p.status === "presente" ? "üü¢" :
      p.status === "medio" ? "üü°" :
      p.status === "alejado" ? "üü§" :
      p.status === "dormido" ? "üí§" :
      "üîá";

    // ICONO DE ROL
    const roleIcon =
      p.role === "moderador" ? "üõ°Ô∏è" :
      "";

    const row = document.createElement("div");

    row.innerHTML = `
      <div class="userRow">
        <button class="chatUserBtn" data-user="${p.name}">üí¨</button>

        <span class="userInfo">
          ${p.flag} üë§ ${p.name} ‚Äî ${p.cards} cards ‚Äî
          ${p.status} ${icon}
          ${p.role ? `‚Äî rol: ${p.role} ${roleIcon}` : ""}
        </span>
      </div>
    `;

    box.appendChild(row);
  }

  console.log("‚úÖ [bola ]Lista renderizada:", players);
}

// ‚úÖ COLORES SEG√öN ESTADO
function statusColor(status) {
  if (status === "ultra") return "rgba(255,255,255,1)";     // ‚ö° blanco
  if (status === "muy_activo") return "rgba(255,0,0,1)";    // üî• rojo
  if (status === "activo") return "rgba(255,80,0,1)";       // üî• naranja fuerte
  if (status === "reciente") return "rgba(255,150,0,1)";    // üü† naranja
  if (status === "presente") return "rgba(0,200,0,1)";      // üü¢ verde
  if (status === "medio") return "rgba(255,255,0,1)";       // üü° amarillo
  if (status === "alejado") return "rgba(150,100,50,1)";    // üü§ marr√≥n
  if (status === "dormido") return "rgba(150,150,150,1)";   // üí§ gris
  return "rgba(0,120,255,1)";                               // üü¶ azul offline
}

// ‚úÖ DISTRIBUCI√ìN DE PUNTOS BLANCOS
console.log("‚ú® [SPHERE] Generando puntos base‚Ä¶");

const num = 500;
for (let i = 0; i <= num; i++) {
  const k = -1 + (2 * (i + 1) - 1) / num;
  const a = Math.acos(k);
  const b = a * Math.sqrt(num * Math.PI);
  const x = Radius * Math.sin(a) * Math.cos(b);
  const y = Radius * Math.sin(a) * Math.sin(b);
  const z = Radius * Math.cos(a);
  balls.push({ x, y, z, r: 1.5, color: null });
}

console.log("‚úÖ [SPHERE] Puntos generados:", balls.length);

// ‚úÖ ROTACI√ìN
function rotateX(arr) {
  const cos = Math.cos(angleX);
  const sin = Math.sin(angleX);
  for (let p of arr) {
    const y1 = p.y * cos - p.z * sin;
    const z1 = p.z * cos + p.y * sin;
    p.y = y1;
    p.z = z1;
  }
}

function rotateY(arr) {
  const cos = Math.cos(angleY);
  const sin = Math.sin(angleY);
  for (let p of arr) {
    const x1 = p.x * cos - p.z * sin;
    const z1 = p.z * cos + p.x * sin;
    p.x = x1;
    p.z = z1;
  }
}



// ‚úÖ DIBUJAR PUNTO
function paint(p) {
  if (p.z < 0) return; // ‚≠ê NO pintar puntos detr√°s

  const fl = 450;
  const scale = fl / (fl - p.z);
  const alpha = (p.z + Radius) / (2 * Radius);
  ctx.save();
  ctx.beginPath();
  ctx.arc(vpx + p.x, vpy + p.y, p.r * scale, 0, 2 * Math.PI);
 // ctx.fillStyle = p.color || `rgba(255,255,255,${alpha + 0.1})`;
  
 if (!p.color) {
    const opacity = (p.z + Radius) / (2 * Radius) * 0.4; // ‚≠ê m√°s suave
    ctx.fillStyle = `rgba(255,255,255,${opacity})`;
} else {
    ctx.fillStyle = p.color;
}


  ctx.fill();
  ctx.restore();
}

// ‚úÖ LAT/LON ‚Üí XYZ
function latLonToXYZ(lat, lon, r = 4, color = "rgba(255,0,0,1)") {
    
  //const latRad = lat * Math.PI / 180;
  //const lonRad = lon * Math.PI / 180;
  const latRad = lat * Math.PI / 180;
  const lonRad = lon * Math.PI / 180;
  const x = Radius * Math.cos(latRad) * Math.cos(lonRad);
  const y = Radius * Math.sin(latRad);
  const z = Radius * Math.cos(latRad) * Math.sin(lonRad);
  return { x, y, z, r, color };
}



//function addCoastPoint(lat, lon) {
//  const ball = latLonToXYZ(lat, lon, 2, "rgba(0,0,0,0.8)");
//  coastBalls.push(ball);
//}

  function addCoastPoint(lat, lon, r = 0.6) {
  const ball = latLonToXYZ(lat, lon, r, "rgba(255,255,255,0.85)");
  ball.fixed = true; // ‚≠ê tama√±o fijo para que parezca l√≠nea
  coastBalls.push(ball);
}
        

// ‚úÖ A√ëADIR JUGADORES A LA ESFERA
function addPlayersToSphere() {
  console.log("üåç [SPHERE] A√±adiendo jugadores a la esfera‚Ä¶");
 console.log("üõï    A√±adiendo ciudades del mundo a la esfera‚Ä¶");
  userBalls.length = 0;

  for (let p of players) {
    const ball = latLonToXYZ(
      p.lat,
      p.lon,
      2 + p.cards * 0.3,
      statusColor(p.status)
    );
// ‚≠ê aplicar offset inicial de rotaci√≥n Y
const cos = Math.cos(angleY);
const sin = Math.sin(angleY);

const x1 = ball.x * cos - ball.z * sin;
const z1 = ball.z * cos + ball.x * sin;

ball.x = x1;
ball.z = z1;    
    // ‚≠ê Solo invertir Y para jugadores
//ball.y = -ball.y
//ball.x = -ball.x;   // ‚≠ê invierte el eje X solo para jugadores//loscambiadeladoatodos
ball.y = -ball.y;   // corrige hemisferio norte/sur
//ball.x = -ball.x;   // corrige este/oeste

    ball.name = p.name;
      ball.flag = p.flag;       // ‚úîÔ∏è flag tambi√©n
       userBalls.push(ball);
  }

  console.log("‚úÖ [SPHERE] Jugadores a√±adidos:", userBalls);
}

// ‚úÖ HOVER
canvas.addEventListener("mousemove", (e) => {
  if (!hoverEnabled) return;   // ‚≠ê A√ëADIDO AQU√ç

  const rect = canvas.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;

  hoveredPlayer = null;

  for (let p of userBalls) {
    const fl = 450;
    const scale = fl / (fl - p.z);
    const px = vpx + p.x;
    const py = vpy + p.y;
    const radius = p.r * scale;

    const dx = mx - px;
    const dy = my - py;
    const dist = Math.sqrt(dx * dx + dy * dy);

    if (dist < radius + 5) {
      hoveredPlayer = p;
      break;
    }
  }
});



// ‚úÖ ANIMACI√ìN
function animate() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // ‚≠ê Solo rotamos si rotationEnabled = true
  if (rotationEnabled) {
    rotateX(balls);
    rotateY(balls);
    rotateX(userBalls);
    rotateY(userBalls);

    // ‚≠ê ROTAR TAMBI√âN LAS CIUDADES
    rotateX(cityBalls);
    rotateY(cityBalls);
    rotateX(coastBalls);
    rotateY(coastBalls);
   
      
  }

  // ‚≠ê PINTAR TODAS LAS CIUDADES CON SU NOMBRE SIEMPRE
 for (let c of cityBalls) {
    const fl = 450;
    const scale = fl / (fl - c.z);

    const px = vpx + c.x;
    const py = vpy + c.y;

    // ‚≠ê Ocultar ciudades detr√°s, PERO NO N/S
    if (c.z < 0 && c.name !== "N" && c.name !== "S") continue;

    ctx.save();
    ctx.textAlign = "center";

    const isPole = (c.name === "N" || c.name === "S");

    ctx.font = isPole ? "bold 22px sans-serif" : "12px sans-serif";
    ctx.fillStyle = isPole ? "rgba(255,0,255,1)" : "rgba(0,0,0,1)";

    ctx.fillText(c.name, px, py - (isPole ? 14 : 8));

    ctx.restore();
}

 // const all = balls.concat(userBalls).concat(cityBalls);
 const all = balls.concat(userBalls).concat(cityBalls).concat(coastBalls);

  all.sort((a, b) => b.z - a.z);

  for (let p of all) paint(p);

if (hoveredPlayer) {
  ctx.save();
  /*ctx.font = "14px sans-serif";*/
  ctx.font = "16px sans-serif";
  /*ctx.fillStyle = "#fff";*/
  ctx.fillStyle = "#ff0000";
/*  #00aaff ‚Üí azul el√©ctrico*/
/*#ffcc00 ‚Üí dorado*/
/*#ff66aa ‚Üí rosa ne√≥n*/
/*#00ff88 ‚Üí verde menta*/

 // ctx.textAlign = "center";
//  ctx.fillText(
//    "üë§ " + hoveredPlayer.name,   // ‚≠ê ICONO A√ëADIDO AQU√ç
//    vpx + hoveredPlayer.x,
 //   vpy + hoveredPlayer.y - 10
//  );


 ctx.textAlign = "center";
ctx.fillText(
  "üë§ " + (hoveredPlayer.flag || "") + " " + hoveredPlayer.name,
  vpx + hoveredPlayer.x,
  vpy + hoveredPlayer.y - 10
);

  ctx.restore();
}

  requestAnimationFrame(animate);
}

// ‚úÖ 1. Lista de ciudades (primero SIEMPRE)
const worldCities = [
 
 

 

  // ‚≠ê Polos
  { name: "N", lat: 90, lon: 0 },
  { name: "S", lat: -90, lon: 0 },

  // ‚≠ê Referencia del meridiano 0
 /* { name: "Greenwich", lat: 51.4769, lon: 0.0000 }*/
];


 /*addCoastPoint(39.7270, 2.4880);*/
/*üö©estoeranlospuntosdemallorcaperfil*/

// ‚≠ê‚≠ê‚≠ê FIN DEL BLOQUE ‚≠ê‚≠ê‚≠ê

// ‚úÖ 2. Funci√≥n que usa esa lista
function addWorldCities() {
  console.log("üåé A√±adiendo ciudades del mundo a la esfera‚Ä¶");

  cityBalls.length = 0;

  for (let c of worldCities) {

    // ‚≠ê Detectamos si es N o S
    const isPole = (c.name === "N" || c.name === "S");

    const ball = latLonToXYZ(
      c.lat,
      c.lon,
      isPole ? 7 : 3, // ‚≠ê bolita m√°s grande para N y S
      isPole ? "rgba(255,0,255,1)" : "rgba(0,150,255,0.9)" // ‚≠ê color especial
    );

    ball.name = c.name;
    cityBalls.push(ball);
  }

  console.log("‚úÖ Ciudades a√±adidas:", cityBalls.length);
}


function stopRotation() {
  rotationEnabled = false;
}

function startRotation() {
  rotationEnabled = true;
}

function disableHover() {
  hoverEnabled = false;
  hoveredPlayer = null;
}

function enableHover() {
  hoverEnabled = true;
}




//for (let lat = -80; lat <= 80; lat += 5) {
//  addCoastPoint(lat, 0);
//  addCoastPoint(lat, 10);
//  addCoastPoint(lat, 20);

//}

// Paralelos
//for (let lon = -180; lon <= 180; lon += 5) {
//  addCoastPoint(0, lon);
//  addCoastPoint(23.5, lon);
//  addCoastPoint(-23.5, lon);

//}

// ‚≠ê MALLA COMPLETA DE MERIDIANOS (cada 10¬∞)    FUNCIONA
//for (let lon = -180; lon <= 180; lon += 10) {
//  for (let lat = -80; lat <= 80; lat += 2) {
//    addCoastPoint(lat, lon);
//  }
//}
// ‚≠ê 4 MERIDIANOS REALES (0¬∞, 90E, 180¬∞, 90W)
//const meridians = [0, 90, 180, -90];

//for (let lon of meridians) {
//  for (let lat = -80; lat <= 80; lat += 4) {
//    addCoastPoint(lat, lon);
//  }
//}
// ‚≠ê MALLA COMPLETA DE MERIDIANOS (cada 10¬∞)
//for (let lon = -180; lon <= 180; lon += 10) {
//  for (let lat = -80; lat <= 80; lat += 1) {
 //   addCoastPoint(lat, lon, 0.6); // peque√±o y denso
 // }
//}

// Paralelos
//for (let lon = -180; lon <= 180; lon += 5) {
//  addCoastPoint(0, lon);
//  addCoastPoint(23.5, lon);
//  addCoastPoint(-23.5, lon);

//}


// ‚≠ê 8 MERIDIANOS (cada 45¬∞)
const meridians = [0, 45, 90, 135, 180, -45, -90, -135];

for (let lon of meridians) {
  for (let lat = -80; lat <= 80; lat += 1) {
    addCoastPoint(lat, lon);
  }
}

// ‚≠ê PARALELOS IMPORTANTES
const parallels = [
  0,      // Ecuador
  23.5,   // Tr√≥pico de C√°ncer
  -23.5,  // Tr√≥pico de Capricornio
  66,     // C√≠rculo polar √°rtico (aprox)
  -66     // C√≠rculo polar ant√°rtico (aprox)
];

for (let lat of parallels) {
  for (let lon = -180; lon <= 180; lon += 1) {
    addCoastPoint(lat, lon);
  }
}




// ‚úÖ INICIO
(async function start() {
  console.log("üöÄ Iniciando‚Ä¶");

  await loadRegisteredUsers();  // ‚Üê carga autom√°tica desde users.json


  renderPlayerList();
  addPlayersToSphere();
  addWorldCities();

  // ‚≠ê Orientar esfera al inicio

  let initialRotX = Math.PI;  // Polo Norte arriba
  let initialRotY = 0;        // Ecuador recto

  // Guardamos la velocidad real (supongo que angleX/angleY son velocidades peque√±as tipo 0.002)
  const oldX = angleX;
  const oldY = angleY;

  // Aplicamos la rotaci√≥n inicial a todos los puntos
  angleX = initialRotX;
  angleY = initialRotY;

  rotateX(balls);
  rotateY(balls);
  rotateX(userBalls);
  rotateY(userBalls);
  rotateX(cityBalls);
  rotateY(cityBalls);
rotateX(coastBalls);
rotateY(coastBalls);

  // Restauramos la velocidad normal (NO 0, tus valores de giro continuo)
  angleX = oldX;
  angleY = oldY;

  // ‚≠ê FIN ORIENTACI√ìN INICIAL

  animate();

  console.log("‚úÖ Sistema funcionando con usuarios reales del JSON");
})();


</script>


<script>
    
 // ‚≠ê Normalizar longitud para adaptarla al motor de tu esfera
function normalizeLon(lon) {
  // Si la longitud es negativa (Oeste real), tu motor la quiere positiva
  if (lon < 0) return -lon;

  // Si la longitud es positiva (Este real), tu motor la quiere negativa
  if (lon > 0) return -lon;

  return lon; // lon = 0 ‚Üí Greenwich
}
   
    
    
</script>



<script>
// ‚úÖ A√ëADIR PI USER REAL A LA ESFERA Y LISTA STOLEN
async function addPiUserToPlayers(username) {
    
  
 
    
  try {
    console.log("üöÄ [PI-USER] A√±adiendo usuario Pi a la bola:", username);

    // ‚úÖ 1. Obtener ubicaci√≥n real
    console.log("üåç [LOCATION] Solicitando ubicaci√≥n real‚Ä¶");
    const locRes = await fetch("/api/location");
    const locData = await locRes.json();
    const loc = locData.location;
    /*console.log("üìç Ubicaci√≥n cruda JSON:", JSON.stringify(locData, null, 2));*/

    //console.log("üìç Ubicaci√≥n cruda:", locData);para uso info*/
    console.log(`üìç Ubicaci√≥n confirmada: ${loc.city}, ${loc.country} ‚Äî lat: ${loc.lat}, lon: ${loc.lon}`);
    console.log("‚úÖ [LOCATION] Ubicaci√≥n recibida:", loc);

    // ‚úÖ 2. Obtener cards reales desde tu backend
    console.log("üñº [GALLERY] Solicitando gallery real para:", username);
    const galleryRes = await fetch(`/api/gallery?userId=${username}`);
    const galleryData = await galleryRes.json();

    const cards = galleryData.gallery.length;
    console.log(`‚úÖ [GALLERY] ${username} tiene ${cards} cards reales`);

    // ‚úÖ 3. Crear jugador STOLEN real
   // const player = {
   //   name: username,
   //   lat: loc.lat,
   //   lon: loc.lon,
    //  cards: cards,
     // status: "activo"
   // };
   
   ///////////////////////////con bandera
   const player = {
  name: username,
  lat: loc.lat,
  //lon: loc.lon,
  
  lon: normalizeLon(loc.lon),

  cards: cards,
  status: "activo",
  flag: countryToFlag(loc.country),   // ‚≠ê A√ëADIDO
    role: "moderador"   // ‚≠ê A√ëADIR ESTO
};

   
   
   
      document.getElementById("info").textContent = `Ubicaci√≥n: ${loc.lat}, ${loc.lon}`;
    console.log("üéØ [PLAYER] Jugador generado:", player);

    // ‚úÖ 4. A√±adir a la lista global
   // players.push(player);
   // console.log("üì¶ [PLAYERS] Lista actualizada:", players);
   
   // ‚úÖ 4. Reemplazar usuario del JSON por el usuario Pi real

// ‚ùå Eliminar cualquier entrada previa del mismo usuario
for (let i = players.length - 1; i >= 0; i--) {
  if (players[i].name === username) {
    players.splice(i, 1);
  }
}

// ‚úîÔ∏è A√±adir el usuario Pi real
players.push(player);

console.log("üì¶ [PLAYERS] Lista actualizada:", players);

   
   
   

    // ‚úÖ 5. Pintar en esfera
    addPlayersToSphere();
    console.log("üåê [SPHERE] Jugador a√±adido a la esfera");

    // ‚úÖ 6. Pintar en lista STOLEN
    renderPlayerList();
    console.log("üìù [bola] Lista actualizada");

  } catch (error) {
    console.error("‚ùå [ERROR] No se pudo a√±adir el Pi User:", error);
  }
}
</script>

 
<script>
// ‚úÖ Usuario real din√°mico (desde localStorage)
function getCurrentUser() {
  return localStorage.getItem("username");     //1
}

// ‚úÖ Activar botones ‚ù§Ô∏è despu√©s de renderizar cards
function activateTransferButtons() {
  const CURRENT_USER = getCurrentUser();

  document.querySelectorAll(".transfer-btn").forEach(btn => {
    btn.addEventListener("click", async (e) => {

      // ‚úÖ TEST DE CLICK ‚Äî si esto no aparece, el bot√≥n NO tiene listener
      console.log("üî• CLICK en bot√≥n ‚ù§Ô∏è");

      const card = e.target.closest(".payment-card"); // ‚úÖ correcto

      const identifier = card.dataset.identifier;
      const sellerId = card.dataset.seller;
      const buyerId = CURRENT_USER;

      // ‚úÖ TEST DE DATA
      //console.log("üß™ DATASET:", { identifier, sellerId, buyerId });
           console.log("üß™ DATASET:", JSON.stringify({ identifier, sellerId, buyerId }, null, 2));

      const res = await fetch("/api/transferCard", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ identifier, sellerId, buyerId })
      });

      const data = await res.json();

      // ‚úÖ TEST DE RESPUESTA
      console.log("üì© Respuesta backend:", data);

      if (data.success) {
        alert(`‚úÖ Transferida: ${identifier} ‚Üí ${buyerId}`);
        loadAllUserGallery(); // refrescar
      } else {
        alert(`‚ùå Error: ${data.error}`);
      }
    });
  });
}
</script>


<script>
async function loadAllUserGallery() {
  try {
    const res = await fetch("/api/gallery/all");
    const data = await res.json();

    if (!data.success) {
      console.error("‚ùå Error cargando galer√≠a global:", data.error);
      return;
    }

    const galleryContainer = document.getElementById("alluserGallery");
    galleryContainer.innerHTML = ""; // limpiar antes de renderizar

    data.gallery.forEach(p => {
      const card = document.createElement("div");
      card.className = "payment-card";

      // ‚úÖ A√±adimos los datos necesarios para el bot√≥n ‚ù§Ô∏è
      card.dataset.identifier = p.metadata.id;   // ‚úÖ AQU√ç
      card.dataset.seller = p.metadata.userId;   // ‚úÖ AQU√ç

card.innerHTML = `
  <div class="card-header">
    <strong>üßæ Pago Pi</strong> ‚Äì ${new Date(p.created_at).toLocaleString()}
    ${p.metadata?.imageURL ? `<img src="${p.metadata.imageURL}" />` : ""}
  </div>

  <div class="card-body">

    <h4>üÜî Identificadores</h4>
    <p><strong>Card ID (minted):</strong> ${p.metadata.id}</p>
    <p><strong>Payment ID:</strong> ${p.identifier}</p>

    <p>üõ° <strong>User UID:</strong> ${p.user_uid}</p>
    <p>üí≤ <strong>Amount:</strong> ${p.amount}</p>
    <p>üìú <strong>Memo:</strong> ${p.memo}</p>
    <p>üòç <strong>From Address:</strong> ${p.from_address}</p>
    <p>‚ú® <strong>To Address:</strong> ${p.to_address}</p>
    <p>‚Üí <strong>Direction:</strong> ${p.direction}</p>
    <p>üìÜ <strong>Created At:</strong> ${p.created_at}</p>
    <p>üåé <strong>Network:</strong> ${p.network}</p>

    <h4>üìé Metadata</h4>
    <ul>
      ${Object.entries(p.metadata || {})
        .map(([k, v]) => `<li><strong>${k}:</strong> ${v}</li>`)
        .join("")}
    </ul>
  </div>

  <div class="card-actions">
    <button class="transfer-btn">‚ù§Ô∏è Transfer</button>
    <button onclick="#">üí≤ Buy</button>
    <button onclick="copyToClipboard('${p.transaction?._link}')">üîó Copiar enlace</button>
    <button onclick="downloadJSON(p)">üì• Descargar JSON</button>
  </div>
`;


      galleryContainer.appendChild(card);
     

    });

    // ‚úÖ Activar botones despu√©s de renderizar
    activateTransferButtons();
console.log("‚úÖ activateTransferButtons cargado");

  } catch (err) {
    console.error("‚ùå Error en loadAllUserGallery:", err);
  }
}
</script>

<script>
    
  function safeParseJSON(str) {
  try { return JSON.parse(str); } catch { return { note: String(str || "").trim() }; }
}

function getSelectedGalleryItem() {
  return document.querySelector(".gallery-item.selected");
}

function buildPayloadFromGallery() {
  const amount = parseFloat(document.getElementById("payment-amount").value) || 0;
  const memo = document.getElementById("payment-memo").value.trim();
  const metaRaw = document.getElementById("payment-metadata").value;

  const metadata = safeParseJSON(metaRaw);
  metadata.orderId = "order_" + Date.now();
  metadata.userId = window.currentUser?.uid || localStorage.getItem("usuarioActivo") || "anon"; //2

  const selected = getSelectedGalleryItem();
  if (selected) {
    // Ruta persistente, EXACTAMENTE la que sirve tu servidor
    const path = selected.dataset.path;        // ej: "/user/gallery/lucky.webp"
    metadata.imageURL = path;                  // esta es la que se guarda en el pago
  } else {
    // Sin selecci√≥n: deja expl√≠cito vac√≠o para auditar
    metadata.imageURL = "";
  }

  return { amount, memo, metadata };
}

document.getElementById("createPaymentBtn").addEventListener("click", () => {
  const payload = buildPayloadFromGallery();
  document.getElementById("paymentOutput").textContent = JSON.stringify(payload, null, 2);
});
  
 async function uploadImage(file) {
const formData = new FormData();
formData.append("userId", currentUser.uid);

// payload como JSON ‚Üí archivo .json
formData.append(
  "json",
  new Blob([JSON.stringify(paymentObj, null, 2)], { type: "application/json" }),
  `${paymentObj.identifier}.json`
);

// imagen seleccionada
if (selectedFile) {
  formData.append("image", selectedFile, selectedFile.name);
}

fetch("/api/guardarImagen", { method: "POST", body: formData });
  
</script>

<script>
function buildPayload() {
  const amount = parseFloat(document.getElementById("payment-amount").value);
  const memo = document.getElementById("payment-memo").value;
  const metadataInput = document.getElementById("payment-metadata").value;

  let metadata;
  try {
    metadata = JSON.parse(metadataInput);
  } catch {
    metadata = { note: metadataInput };
  }

  metadata.orderId = "order_" + Date.now();
  metadata.userId = currentUser.uid;

  // ‚úÖ Aqu√≠ decides qu√© meter en imageURL
  const selected = document.querySelector(".gallery-item.selected img");
  if (selected) {
    const fileName = selected.getAttribute("data-filename"); 
    metadata.imageURL = `/user/gallery/${fileName}`;
  } else {
    metadata.imageURL = "";
  }

  const payload = { amount, memo, metadata };

  // üìå Aqu√≠ va el log
  console.log("üßæ Payload de pago construido:", payload);

  return payload;
}

    
</script>

<script>
// items: el array generado por el minteador
function renderGallery(items) {
  const container = document.getElementById("gallery");
  container.innerHTML = "";

  items.forEach(obj => {
    const div = document.createElement("div");
    div.className = "gallery-item";
    div.setAttribute("data-filename", obj.originalName);
    div.onclick = () => selectImage(div);

    const img = document.createElement("img");
    img.src = obj.galleryPath;
    div.appendChild(img);

    container.appendChild(div);
  });
}

function selectImage(el) {
  document.querySelectorAll(".gallery-item").forEach(d => d.classList.remove("selected"));
  el.classList.add("selected");
}
    
</script>
                                                          

<script>
function renderPaymentCard(paymentJson) {
  const gallery = document.getElementById("userGallery");
  if (!gallery) {
    console.warn("‚ö†Ô∏è Contenedor #userGallery no encontrado");
    return;
  }

  const p = paymentJson.payment;
  const card = document.createElement("div");
  card.className = "payment-card";
  card.dataset.txid = p.transaction?.txid || "no-txid";

  // Renderizar todos los campos
  card.innerHTML = `
    <div class="card-header">
      <strong>üßæ Pago Pi</strong> ‚Äì ${new Date(p.created_at).toLocaleString()}
      ${p.metadata?.imageURL ? `<img src="${p.metadata.imageURL}" />` : ""}
    </div>

    <div class="card-body">
       <p> üîé ver datos </p> 
      <p>üîó<strong>Identifier:</strong> ${p.identifier}</p>
      <p>üõ°<strong>User UID:</strong> ${p.user_uid}</p>
      <p>üí≤<strong>Amount:</strong> ${p.amount}</p>
      <p>üìú<strong>Memo:</strong> ${p.memo}</p>
      <p>üòç<strong>From Address:</strong> ${p.from_address}</p>
      <p>‚ú®<strong>To Address:</strong> ${p.to_address}</p>
      <p>‚Üí<strong>Direction:</strong> ${p.direction}</p>
      <p>üìÜ<strong>Created At:</strong> ${p.created_at}</p>
      <p>üåé<strong>Network:</strong> ${p.network}</p>

      <h4>üìé Metadata</h4>
      <ul>
        ${Object.entries(p.metadata || {}).map(([k,v]) => `<li><strong>${k}:</strong> ${v}</li>`).join("")}
      </ul>

      <h4>üì° Status</h4>
      <ul>
        ${Object.entries(p.status || {}).map(([k,v]) => `<li><strong>${k}:</strong> ${v}</li>`).join("")}
      </ul>

      <h4>üîó Transaction</h4>
      <ul>
        ${Object.entries(p.transaction || {}).map(([k,v]) => {
          if(k === "_link") {
            return `<li><strong>${k}:</strong> <a href="${v}" target="_blank">${v}</a></li>`;
          }
          return `<li><strong>${k}:</strong> ${v}</li>`;
        }).join("")}
      </ul>
    </div>

    <div class="card-actions">
      <button onclick="copyToClipboard('${p.transaction?._link}')">üîó Copiar enlace</button>
      <button onclick="downloadJSON(p)">üì• Descargar JSON</button>
    </div>
  `;

  gallery.appendChild(card);
}



function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(() => {
    console.log("üîó Enlace copiado");
  });
}

function downloadJSON(obj) {
  const blob = new Blob([JSON.stringify(obj, null, 2)], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `payment-${obj.identifier || Date.now()}.json`;
  a.click();
  URL.revokeObjectURL(url);
}
  
    
</script>

<script>
function logToConsole(message, type = "log") {
  const consoleDiv = document.getElementById("console");
  const line = document.createElement("div");
  line.textContent = `[${type.toUpperCase()}] ${message}`;
  consoleDiv.appendChild(line);
  consoleDiv.scrollTop = consoleDiv.scrollHeight;
}

const originalLog = console.log;
const originalError = console.error;

console.log = function (...args) {
  originalLog.apply(console, args);
  logToConsole(args.join(" "), "log");
};

console.error = function (...args) {
  originalError.apply(console, args);
  logToConsole(args.join(" "), "error");
};

function updateStatus(message, targetId="user-status") {
  document.getElementById(targetId).textContent = message;
  logToConsole(message, "status");
}
</script>



<script>
                               // Inicializar galer√≠a desde backend  ///////////////ok
async function inicializarGaleria() {
  const userId = getUserUid();
  const container = document.getElementById("userGallery");
  container.innerHTML = "";
  console.log("üîÑ Inicializando galer√≠a para userId:", userId);

  try {
    const res = await fetch(`/api/gallery?userId=${userId}`);
    const data = await res.json();
    console.log("üì• Respuesta de /api/gallery:", data);

    if (data.success && Array.isArray(data.gallery)) {
      data.gallery.forEach(payment => {
        console.log("üñº Renderizando card desde galer√≠a:", payment.identifier || payment.transaction?.txid);
        renderPaymentCard({ payment });
      });
      console.log(`‚úÖ Galer√≠a renderizada con ${data.gallery.length} card(s)`);
    } else {
      console.warn("‚ö†Ô∏è No hay cards en la galer√≠a del usuario");
    }
  } catch (err) {
    console.error("‚ùå Error cargando galer√≠a:", err);
  }
}

                               // Guardar en backend             //////////////////ok
async function guardarEnGaleria(paymentObj) {
  try {
    const userId = getUserUid();

    console.log("üíæ Intentando guardar en galer√≠a con:", {
      endpoint: "/app12/user/gallery",   // ‚úÖ corregido: coincide con prefijo real
      userId,
      identifier: paymentObj.identifier,
      txid: paymentObj.transaction?.txid,
      username: paymentObj.user_uid || paymentObj.username || "no-username"
    });

    const res = await fetch("/app12/user/gallery", {   // ‚úÖ corregido
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ userId, payment: paymentObj })
    });

    const raw = await res.text();
    console.log("üì• Respuesta cruda del backend:", raw);

    let data;
    try {
      data = JSON.parse(raw);
    } catch (parseErr) {
      console.error("‚ùå Error parseando respuesta como JSON:", parseErr.message);
      console.error("‚ö†Ô∏è El backend devolvi√≥ HTML en vez de JSON. Revisa la ruta /app12/user/gallery");
      console.error("üîé Primeros 200 caracteres de la respuesta:", raw.slice(0, 200));
      return;
    }

    // ‚úÖ Log adicional: confirmaci√≥n del objeto parseado
    console.log("üì¶ Objeto JSON parseado correctamente:", data);

    if (data.success) {
      console.log("‚úÖ Pago guardado en galer√≠a backend:", {
        identifier: paymentObj.identifier,
        txid: paymentObj.transaction?.txid,
        userId
      });
    } else {
      console.error("‚ùå Error guardando en galer√≠a backend:", data.error);
    }
  } catch (e) {
    console.error("‚ùå Error guardando en galer√≠a:", e);
  }
}

</script>

 <script>

document.addEventListener("DOMContentLoaded", async () => {
  console.log("‚úÖ   ‚úî   DOM cargado");

  const piUser = localStorage.getItem("piUser");    //3
  console.log("üì¶ Intentando cargar perfil para: " + piUser);

  if (!piUser) {
    alert("Usuario no logueado");
    console.log("üì¶ piUser: null");
    window.location.href = "login.html";
    return;
  }

  // Cargar perfil y balances
   await cargarPerfil(piUser);
   //cargarImagenPerfil(piUser);
  // await cargarWallet(piUser); // solo si tienes esta funci√≥n definida
   // ‚úÖ A√ëADIR A LA ESFERA Y STOLEN
 // await addPiUserToPlayers(piUser);
//O si usas currentUser.username:
await addPiUserToPlayers(currentUser.username);

// cargargaleriaglobal   
   
 loadAllUserGallery();
 consultarBalance("GDX74DOK4INDEG77UTIFJOU7QDBBWMIOSWH32NTGCUOXCVC6LM3NUZFM");
 cargarBalanceReceptor("GCG3CQSICTJFI5YF43ZYTV7YCOJJWKNWTFZTSLWMDET27SYHQ4SQ7FYO","piaPPBalance" );
  // üñº Inicializar galer√≠a del usuario
  inicializarGaleria();    //1
});





function getUserUid() {
  return (
    window.perfil?.userId ||
    window.perfil?.username ||
    window.piUser ||
    window.uid ||
    
    localStorage.getItem("usuarioActivo") ||    //4
    "anon"
  );
}

const a = document.createElement('a');
a.href = url;
a.download = fileName;
document.body.appendChild(a);
a.click();
document.body.removeChild(a);
URL.revokeObjectURL(url);


async function cargarPerfil(piUser) {
    
    
  document.querySelector(".status").textContent = "‚úÖ   ‚ùó Sesi√≥n iniciada";



  try {
   // const res = await fetch(`/app12/public/data/users/${piUser}/config/perfil.json`);
    
    const res = await fetch(`/app12/public/data/users/${piUser}/config/perfil.json`);
    
    
    
    
    const perfil = await res.json();
    window.perfil = perfil; // üîí disponible para getUserUid()
    
    // ‚úÖ A√ëADIR AQU√ç MISMO, SIN PENSAR
   localStorage.setItem("username", perfil.username);
   
   
 //  console.log("  üò§  username: " + perfil.username);
   console.log("‚ú® Perfil recibido: " + JSON.stringify(perfil));
   console.log("  üò§  username: " + perfil.username);
   
   console.log("üòÖ userUid cargado: " + getUserUid());
   console.log("üìß email: " + perfil.email);
  // console.log("üòé owner: " + perfil.owner);
   console.log(" üõ†  piUser: " + perfil.piUser);     //este se repite
   console.log("‚ú®  WalletAddress: " + perfil.WalletAddress);
   console.log(`‚úÖ    üí≤  Sesi√≥n iniciada como ${piUser}`);
 //  console.log("üë§  User: " + perfil.User);
   // showPopup(`üë§ Bienvenido ${piUser}`);//esto rompe ‚ùó

   //console.log("üîê id: " + wallet.id);
   console.log("üîê id: " + perfil.id);


    if (perfil.error) {
      alert("Error al cargar perfil: " + perfil.error);
      console.log("‚ùå Error al cargar perfil: " + perfil.error);
      return;
    }

//    // ‚úÖ Renderizado b√°sico

     if (perfil.piUser) document.getElementById("piUser").textContent = perfil.piUser;  ///‚ùó‚ùó‚ùó‚ùó‚ùó‚ùó

//    if (perfil.email) document.getElementById("email").textContent = perfil.email;

 //   if (perfil.status) document.getElementById("status").textContent = "‚úÖ Sesi√≥n iniciada";

   //   if (perfil.userId) document.getElementById("userId").textContent = perfil.userId;
       // if (perfil.owner) document.getElementById("owner").textContent = perfil.owner;
      //  if (perfil.User) document.getElementById("User").textContent = perfil.User;
        
 // if (perfil.username) document.getElementById("username").textContent = perfil.username;
     document.getElementById("bienvenida").textContent = ` ‚Äî‚ú®  Sesi√≥n activa como   :username ${perfil.username}`;    
  
   
document.getElementById("bienvenida2").textContent = ` ‚Äî œÄ  Sesi√≥n activa como  :userId ${perfil.userId}`;




 
 
  
    if (perfil.email) document.getElementById("email").textContent = perfil.email;
    if (perfil.userId) document.getElementById("userId").textContent = perfil.userId;
    if (perfil.WalletAddress) document.getElementById("WalletAddress").textContent = perfil.WalletAddress;
    if (perfil.id) document.getElementById("id").textContent = perfil.id;
    
    
    if (perfil.createdAt) document.getElementById("createdAt").textContent = perfil.createdAt;
     console.log("üìÜ createdAt: " + perfil.createdAt);
     
     
  //  if (perfil.status) document.getElementById("status").textContent = " üö© ‚úî   üöÄ  Sesi√≥n iniciada";
 //   if (perfil.balance) document.getElementById("balance").textContent = perfil.balance;
   // if (perfil.User) document.getElementById("User").textContent = perfil.User;
  //‚ùó  if (perfil.user) document.getElementById("user").textContent = perfil.user;
    // if (perfil.mintedImages) document.getElementById("mintedImages").textContent = perfil.mintedImages;
      
      
      // console.log(" üòã   userId: " + wallet.userId);
    
   // console.log("  üò§  username: " + perfil.username);
    
    
    //  console.log("üòÖ userUid cargado: " + getUserUid());

     // console.log("üí≤   USER hotWalletBalance cargado: " + wallet.balances.hotWalletBalance);
    //  console.log("‚ôª    USER Balance cargado: " + wallet.balances.offline);
     // console.log("‚ú®  WalletAddress: " + wallet.WalletAddress);
    //  console.log("üîê id: " + wallet.id);
     // console.log("üìÜ createdAt: " + wallet.createdAt);
    //  console.log("üìß email: " + perfil.email);
    //  console.log("üòé owner: " + wallet.owner);
    //  log("üñº mintedImages: " + wallet.mintedImages);
   // console.log("üñº mintedImages: " + wallet.mintedImages);

    //  console.log("üåé  üß™   online: " + perfil.balances.online);
   //   console.log("üîê   üß™   offline: " + perfil.balances.offline);
    
    // console.log(`‚úÖ    üí≤  Sesi√≥n iniciada como ${piUser}`);
       
  
     
     
      // document.getElementById("bienvenida").textContent = ` ‚Äî‚ú®    üö© Sesi√≥n activa como ${perfil.userId}`;
      

       
  } catch (err) {
      
      console.log("piUser:", piUser);
    console.log("Respuesta del backend:", perfil);
    

    console.error("Error al cargar perfil:", err);
  }
}

async function cargarImagenPerfil(piUser) {
  try {
    // Construye la ruta din√°mica a la imagen de perfil
    const img = document.querySelector(".user-img");
    img.onerror = () => {
      img.src = "https://www.3coma14apps.com/app12/public/data/users/GemmaTorrello/gallery/placeholder-user.jpg";
    };
    img.src = `https://www.3coma14apps.com/app12/public/data/users/${piUser}/gallery/profile.jpg`;

    console.log(`üñº Imagen de perfil cargada para ${piUser}`);
  } catch (err) {
    console.error("Error al cargar imagen de perfil:", err);
  }
}





</script>

 <script>
 function log(msg) {
  const consola = document.getElementById("consola");
  if (consola) {
    const linea = document.createElement("div");
    linea.textContent = msg;
    consola.appendChild(linea);
  }
}

 </script>

 <script>
async function cargarWallet() {
  const piUser = localStorage.getItem("piUser");   //5
  if (!piUser) {
    console.log("‚ùå Usuario no logueado");
    return;
  }
    ////////////////////////////////////////////////////cargarWallet() 
  const ruta = `/app12/public/data/users/${piUser}/wallets/usb-offline-wallet.json`;

  try {
    const res = await fetch(ruta);
    const wallet = await res.json();
    
    ///////////////
    window.wallet = wallet; // opcional: guardar globalmente
  
 
   
    
    console.log("üí≥ Wallet recibido: " + JSON.stringify(wallet));

    if (wallet.balances) {
        
        
       //  document.getElementById("online").textContent = `${perfil.balances.online} œÄ`;
       // document.getElementById("online").textContent = `${perfil.balances.online} œÄ`;
        
     // document.getElementById("offline").textContent = wallet.balances.offline;
    //  document.getElementById("online").textContent = wallet.balances.online;  
    
  // document.getElementById("onlineBalanceDisplay").textContent = perfil.userBalance;   
    
    
    
    
    
     //  console.log("üåé  üß™   online: " + wallet.balances.online);
  // console.log("üîê   üß™   offline: " + wallet.balances.offline);
    
    
    
     //  document.getElementById("id").textContent = wallet.id;
   //    document.getElementById("email").textContent = wallet.email;
     // document.getElementById("walletAddress").textContent = wallet.walletAddress;
       
       
       
     //  document.getElementById("status").textContent = "‚úÖ   üö©  üß® Sesi√≥n iniciada";
      //  document.getElementById("piBalance").textContent = perfil.hotWalletBalance;
       // 
      //  document.getElementById("userId").textContent = wallet.userId;
        
      //  document.getElementById("piUser").textContent = wallet.piUser;   ////‚ùó
        
        
       
    
        // üß† Actualizar visual
 // document.getElementById('walletAddressMain').textContent = wallet.address;
//  document.getElementById('walletAddressCopy').textContent = wallet.address;
//  document.getElementById('walletIdDisplay').textContent = wallet.address;
//  document.getElementById('privateKeyDisplay').textContent = wallet.privateKey;
//  document.getElementById('seedPhraseDisplay').textContent = wallet.seedPhrase;
//  document.getElementById('keyStatus').textContent = 'Generated';
//  document.getElementById('keyDisplay').style.display = 'block';
// document.getElementById("hotWalletBalance").textContent = wallet.balances.hotWalletBalance;
       
    //  consultarBalanceReal(publicKey);
   
    
  //  consultarBalance("GCG3CQSICTJFI5YF43ZYTV7YCOJJWKNWTFZTSLWMDET27SYHQ4SQ7FYO" );
    
  //  syncHotWalletBalance();
    
 
 //consultarBalance(piBalance);
    //  consultarBalance(publicKey);
    //
   // cargarBalanceReceptor("GCG3CQSICTJFI5YF43ZYTV7YCOJJWKNWTFZTSLWMDET27SYHQ4SQ7FYO","piaPPBalance" );
       
       
       // console.log("  ü•∞   userUid cargado: " + getUserUid());
       
       
      
       
        
    //  log(" üò§   userUid cargado: " + perfil.userUid); 
    //  console.log("üë§     User cargado: " + perfil.username); 
     // console.log("üí≥  USER hotWalletBalance cargado: " + wallet.balances.hotWalletBalance);
    //  console.log("üí∞  USER Balance cargado: " + wallet.balances.offline);
     // console.log("‚ú®  WalletAddress: " + wallet.WalletAddress);
   /  console.log("üîê id: " + wallet.id);
      //console.log("üìÜ createdAt: " + wallet.createdAt);
     // console.log("üìß email: " + wallet.email);
    //  console.log("üòé owner: " + wallet.owner);
     // console.log("üñº mintedImages: " + wallet.mintedImages);
     // console.log("üåé online: " + wallet.balances.online);
     // console.log("üîê offline: " + wallet.balances.offline);
     
      //console.log("üõ° piUser: " + wallet.piUser);
      
     // log("üîë PrivateKey: " + wallet.privateKey);

      
    } else {
      console.log("‚ö†Ô∏è Wallet sin balances definidos");
    }
  } catch (err) {
    console.log("‚ùå Error al cargar wallet: " + err.message);
  }
}
</script>
<script>
 const selector = document.getElementById("walletSelector");
  if (selector) {
    selector.onchange = actualizarDestinoDesdeSelector;
  }

  // Utils
  function log(msg, type = 'log', className = '') {
    const time = new Date().toLocaleTimeString();
    const line = `<span class="log-line ${className}">[${time}] ${msg}</span><br>`;
    logsEl.insertAdjacentHTML('beforeend', line);
    logsEl.scrollTop = logsEl.scrollHeight;
    console[type](msg);
    registrarLog(msg);
  }

  function registrarLog(msg) {
    fetch("https://www.3coma14apps.com/app12/log", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        log: msg,
        user: piUser || "‚Äî",
        timestamp: new Date().toISOString()
      })
    }).catch(() => {});
  }

  
  function addPaymentRow(user, amount, memo, txid, status) {
    const row = `<tr>
      <td>${user}</td><td>${amount}</td><td>${memo}</td><td>${txid || '‚Äî'}</td><td>${status}</td>
    </tr>`;
    document.getElementById('paymentTable').insertAdjacentHTML('afterbegin', row);
  }

  function onIncompletePaymentFound(payment) {
    log(`‚ö†Ô∏è Incomplete payment found: ${JSON.stringify(payment)}`, 'warn');
  }

 

  async function piPay() {                                   ///piPay
    payBtn.disabled = true;

    const amount = parseFloat(document.getElementById('amount').value);
    const memo = document.getElementById('memo').value.trim();
    const metadata = { memo, mode: currentMode };

    if (isNaN(amount) || amount <= 0) {
      log('‚ö†Ô∏è Invalid amount. Enter a number greater than zero.', 'warn');
      payBtn.disabled = false;
      return;
    }

    try {
      Pi.createPayment({ amount, memo, metadata }, {
        onReadyForServerApproval: async (paymentId) => {
          log(`‚è≥ Sending to /approve_payment: ${paymentId} (${currentMode})`);   
          try {
            const res = await fetch('/api/complete_payment_pi', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ paymentId, userUid: piUser, metadata })
            });
            const json = await res.json();
            if (res.ok && json.status === 'approved') {
              log(`‚úÖ /approve_payment OK`);
              Pi.approvePayment(paymentId);
            } else {
              throw new Error('Backend did not approve payment');
            }
          } catch (err) {
            log(`‚ùå approve_payment error: ${err.message}`, 'error');
            Pi.rejectPayment(paymentId);
            payBtn.disabled = false;
          }
        },
        onReadyForServerCompletion: async (paymentId, txid) => {
          log(`‚è≥ Sending to /complete_payment: ${paymentId}, TXID: ${txid}`);
          try {
            const res = await fetch('/api/complete_payment_pi', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ paymentId, txid })
            });
            const json = await res.json();
            if (res.ok && json.status === 'completed') {
              log(`‚úÖ /complete_payment OK`);
              addPaymentRow(piUser, amount, memo, txid, json.status);
              Pi.completePayment(paymentId);
            } else {
              throw new Error('Backend did not complete payment');
            }
          } catch (err) {
            log(`‚ùå complete_payment error: ${err.message}`, 'error');
          } finally {
            payBtn.disabled = false;
          }
        },
        onCancel: (paymentId) => {
          log(`‚ùå Payment canceled: ${paymentId}`, 'warn');
          payBtn.disabled = false;
        },
        onError: (err) => {
          log(`‚ùå Payment error: ${err?.message || err}`, 'error');
          payBtn.disabled = false;
        }
      });
    } catch (err) {
      log(`‚ùå Could not start payment: ${err.message}`, 'error');
      payBtn.disabled = false;
    }
  }

  // Events
  toggle.addEventListener('change', (e) => {
    const mode = e.target.checked ? 'Mainnet' : 'Testnet';
    setMode(mode);
    const labelEl = document.querySelector('.toggle-label');
    if (labelEl) {
      labelEl.textContent = mode === 'Mainnet' ? 'üåê Mainnet Mode' : 'üß™ Testnet Mode';
    }
  });
  payBtn.addEventListener('click', piPay);

  // Init
  validarEntornoPi();
});
</script>
<script>
let loadedWallets = [];
let currentKeys = null;
let currentSeedPhrase = null;

function showTab(tabName) {
  document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
  document.getElementById(tabName).classList.add('active');
  event.target.classList.add('active');
}


function updateBalance() {
  const total = loadedWallets.reduce((sum, wallet) => sum + (wallet.value || 0), 0);
  document.getElementById('balanceDisplay').textContent = total + 'œÄ';
}






function signWallet(walletId) {
  if (!currentKeys) {
    alert('Please generate keys first in the Security tab');
    return;
  }
  const signature = 'sig_' + Math.random().toString(36).substring(2, 15);
  alert('Wallet signed with signature: ' + signature);
  const wallet = loadedWallets.find(w => w.id === walletId);
  if (wallet) {
    wallet.signature = signature;
    alert("‚úÖ Imagen marcada para devoluci√≥n. ")  ;
    showPopup("  üí≤  imagen marcada para devoluci√≥n. " );   ////‚úî///modificado correctamente
    
    displayWallet(wallet);
    updateBalance();
  }
}


//window.onload = function() {
//  console.log('Usbcwallet4 Professional Interface Loaded');     //funcion log tonta
//};
</script>

  <script>
  document.getElementById("logoutBtn").addEventListener("click", () => {
    const confirmLogout = confirm("¬øSeguro que quieres cerrar sesi√≥n?");
    if (confirmLogout) {
      localStorage.removeItem("usuarioActivo");
      alert("üëã Sesi√≥n cerrada correctamente.");
      window.location.href = "login.html";
    }
  });
</script>

<script>
  async function cargarBalanceReceptor(publicKey, targetElementId) {
  try {
    //const res = await fetch(`https://horizon-testnet.stellar.org/accounts/${publicKey}`);
    const res = await fetch(`https://api.testnet.minepi.com/accounts/${publicKey}`)
    
    
    const json = await res.json();
    const native = json.balances.find(b => b.asset_type === "native");
    const balance = native?.balance || "0";

    document.getElementById(targetElementId).textContent = balance;
    console.log(`üí≥  PiNetwork üß™    Balance receptor: ${balance}`);
  } catch (err) {
    console.log(`‚ùå Error consultando balance receptor: ${err.message}`, 'error');
  }
}
</script>


<script>
  function consultarBalance(publicKey) {
  if (!publicKey || typeof publicKey !== "string") {
    console.log("‚ö†Ô∏è Clave p√∫blica inv√°lida");
    document.getElementById("piBalance").textContent = "‚Äî";
    return;
  }

  fetch(`https://api.testnet.minepi.com/accounts/${publicKey}`)
    .then(res => {
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      return res.json();
    })
    .then(data => {
      const native = data?.balances?.find(b => b.asset_type === "native");
      const xlm = native?.balance || "0.0000000";
      document.getElementById("piBalance").textContent = xlm;
      console.log(`Testnet  üß™ PiNetwork  user Balance: ${xlm}`);
    })
    .catch(err => {
      console.log(`‚ùå Error al consultar balance desde Pi Testnet: ${err.message}`);
      document.getElementById("piBalance").textContent = "‚Äî";
    });
}
</script>

<!-- ‚úÖ VARIABLES DEL CHAT (deben ir primero) -->
<script>
const form = document.getElementById("chatForm");
const input = document.getElementById("messageInput");
const messagesEl = document.getElementById("messages");
const statusEl = document.getElementById("status");

function appendMessage(text, who = "bot") {
  const div = document.createElement("div");
  div.className = "msg " + (who === "user" ? "msg-user" : "msg-bot");
  div.innerHTML = who === "user"
    ? `<small>T√∫</small>${text}`
    : `<small>${who}</small>${text}`;
  messagesEl.appendChild(div);
  messagesEl.scrollTop = messagesEl.scrollHeight;
}

// ‚úÖ AQU√ç VA TU userId REAL
//currentUserId = userId; 
//currentUserId = username; 
const currentUserId = localStorage.getItem("username");

</script>

<script>
form.addEventListener("submit", async (e) => {
  e.preventDefault();
  const message = input.value.trim();
  if (!message || !targetUserId) return;

  appendMessage(message, "user");
  input.value = "";

  const res = await fetch("/api/chat/send", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      from: currentUserId,
      to: targetUserId,
      text: message
    })
  });

  const data = await res.json();

  if (!data.success) {
    appendMessage("Error enviando mensaje", "bot");
  }
});
</script>


<script>
let targetUserId = null;

document.addEventListener("click", (e) => {
  if (e.target.classList.contains("chatUserBtn")) {
    targetUserId = e.target.dataset.user;

    statusEl.textContent = "üíå  Chateando con: " + targetUserId;

    loadChat(targetUserId);
  }
});

async function loadChat(target) {
  const r = await fetch("/api/chat/load", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      userId: currentUserId,
      target
    })
  });

  const data = await r.json();

  messagesEl.innerHTML = "";

  if (data.success) {
    data.messages.forEach(msg => {
      appendMessage(
        msg.text,
        msg.from === currentUserId ? "user" : "bot"
      );
    });
  }
}
</script>


 <script src="https://www.3coma14apps.com/app12/solomint.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
 <script src="https://www.3coma14apps.com/app7/js/copyWalletAddress.js"></script>
<script src="https://www.3coma14apps.com/app7/js/generateQR.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

</body>
</html>
